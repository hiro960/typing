# 韓国語文法辞典機能 詳細仕様書

## 1. 概要

韓国語タイピング学習アプリに文法辞典機能を追加する。ユーザーが韓国語の文法を体系的に学習・参照できる機能を提供する。

### 1.1 主要機能

| 機能 | 説明 |
|------|------|
| カテゴリ別一覧 | 助詞、語尾、接続表現など15カテゴリで分類 |
| レベルタグ | 初級/中級/上級の3段階レベル表示 |
| 検索機能 | 文法名・意味でキーワード検索 |
| 詳細表示 | 説明、活用規則、例文（音声付き）、比較、ヒント |
| 練習問題 | 空欄補充、選択、タイピング等の問題形式 |
| お気に入り | よく使う文法をお気に入り登録 |

---

## 2. データ構造

### 2.1 ファイル構成

```
application/assets/grammar/
├── grammar_index.json          # マスターインデックス
├── particle/                   # 助詞
│   ├── particle_001.json      # 이/가
│   ├── particle_002.json      # 을/를
│   └── ...
├── ending/                     # 語尾
├── connective/                 # 接続表現
├── honorific/                  # 敬語表現
├── tense/                      # 時制・相
├── expression/                 # 慣用表現
├── numeral/                    # 数詞・助数詞
├── interrogative/              # 疑問詞
├── pronoun/                    # 代名詞・指示詞
├── irregular/                  # 不規則活用
├── voice/                      # 態（受身・使役）
├── quotation/                  # 引用表現
├── negation/                   # 否定表現
├── adverb/                     # 副詞
└── interjection/               # 感嘆詞・間投詞
```

### 2.2 grammar_index.json

```json
{
  "version": "1.0.0",
  "lastUpdated": "2025-12-07T00:00:00Z",
  "categories": {
    "particle": {
      "id": "particle",
      "name": "助詞",
      "description": "名詞に付いて文法的な関係を示す",
      "order": 1,
      "totalItems": 25,
      "items": [
        {
          "id": "grm_particle_001",
          "order": 1,
          "title": "이/가",
          "subtitle": "主格助詞（〜が）",
          "level": "beginner",
          "file": "particle/particle_001.json",
          "tags": ["主格", "基本"]
        }
      ]
    }
  }
}
```

### 2.3 個別文法ファイル（例: particle_001.json）

```json
{
  "id": "grm_particle_001",
  "title": "이/가",
  "subtitle": "主格助詞（〜が）",
  "category": "particle",
  "level": "beginner",
  "tags": ["主格", "基本", "必須"],
  "content": {
    "summary": "名詞の後について、その名詞が文の主語であることを示す助詞です。",
    "formationRules": [
      {
        "condition": "パッチムあり",
        "form": "이",
        "example": "책이 (本が)"
      },
      {
        "condition": "パッチムなし",
        "form": "가",
        "example": "나가 → 내가 (私が)"
      }
    ],
    "usageCases": [
      {
        "title": "主語を示す",
        "description": "文の主語が何かを明確にします",
        "examples": [
          {
            "korean": "사과가 맛있어요.",
            "japanese": "りんごがおいしいです。",
            "pronunciation": "サグァガ マシッソヨ",
          }
        ]
      }
    ],
    "comparison": {
      "title": "은/는 との違い",
      "description": "이/가は新情報や焦点、은/는は旧情報や主題を示します",
      "examples": [
        {
          "grammarA": "이/가",
          "sentenceA": "누가 왔어요? - 철수가 왔어요.",
          "meaningA": "誰が来ましたか？ - チョルスが来ました。（新情報）",
          "grammarB": "은/는",
          "sentenceB": "철수는 학생이에요.",
          "meaningB": "チョルスは学生です。（主題）"
        }
      ]
    },
    "tips": [
      "会話では「가」が「-ㄱ」のように省略されることがあります",
      "「私が」は「나가」ではなく「내가」になります（縮約形）"
    ],
    "relatedGrammar": ["grm_particle_002", "grm_particle_003"]
  },
  "exercises": [
    {
      "id": "ex_001",
      "type": "fill_blank",
      "question": "사과___ 맛있어요.",
      "answer": "가",
      "hint": "「사과」にはパッチムがありません",
      "explanation": "パッチムがない名詞の後には「가」を使います"
    },
    {
      "id": "ex_002",
      "type": "choice",
      "question": "다음 중 맞는 문장은?",
      "choices": ["나가 했어요.", "내가 했어요.", "나이 했어요.", "내이 했어요."],
      "answerIndex": 1,
      "explanation": "「나 + 가」は縮約されて「내가」になります"
    },
    {
      "id": "ex_003",
      "type": "typing",
      "question": "「本がある」を韓国語で入力してください",
      "answer": "책이 있어요",
      "acceptableAnswers": ["책이 있어요.", "책이 있어요", "책이있어요"],
      "hint": "本 = 책"
    }
  ]
}
```

---

## 3. カテゴリ定義

| カテゴリID | 日本語名 | 説明 | 想定項目数 |
|-----------|---------|------|-----------|
| particle | 助詞 | 名詞に付いて文法的な関係を示す | 25項目 |
| ending | 語尾 | 動詞・形容詞の活用語尾 | 35項目 |
| connective | 接続表現 | 文と文をつなぐ表現 | 22項目 |
| honorific | 敬語表現 | 尊敬語・謙譲語の表現 | 15項目 |
| tense | 時制・相 | 過去・現在・未来・進行などの表現 | 12項目 |
| expression | 慣用表現 | よく使われる文法的な慣用表現 | 25項目 |
| numeral | 数詞・助数詞 | 固有数詞・漢数詞・助数詞 | 22項目 |
| interrogative | 疑問詞 | 疑問代名詞・疑問副詞 | 12項目 |
| pronoun | 代名詞・指示詞 | 人称・指示・再帰代名詞 | 15項目 |
| irregular | 不規則活用 | 各種不規則動詞・形容詞の活用 | 10項目 |
| voice | 態（受身・使役） | 受身形・使役形の作り方 | 12項目 |
| quotation | 引用表現 | 直接・間接引用 | 11項目 |
| negation | 否定表現 | 否定・禁止の表現 | 7項目 |
| adverb | 副詞 | 程度・頻度・様態・呼応副詞 | 24項目 |
| interjection | 感嘆詞・間投詞 | 感嘆・応答・呼びかけ表現 | 12項目 |

---

## 4. レベル定義

| レベル | 日本語名 | TOPIK基準 | 色 |
|--------|---------|----------|-----|
| beginner | 初級 | TOPIK I（1-2級） | secondary |
| intermediate | 中級 | TOPIK II（3-4級） | primaryBright |
| advanced | 上級 | TOPIK II（5-6級） | accentEnd |

---

## 5. 練習問題タイプ

| type | 説明 | 必須フィールド |
|------|------|---------------|
| fill_blank | 空欄補充 | question, answer, hint, explanation |
| choice | 選択問題 | question, choices, answerIndex, explanation |
| typing | タイピング入力 | question, answer, acceptableAnswers, hint |
| translation | 翻訳問題 | japanese, answer, acceptableAnswers |
| matching | マッチング | pairs (配列), explanation |

---

## 6. アーキテクチャ

### 6.1 ディレクトリ構成

```
lib/features/grammar/
├── data/
│   ├── models/
│   │   ├── grammar_models.dart        # Enum定義
│   │   ├── grammar_index.dart         # インデックスモデル
│   │   ├── grammar_detail.dart        # 詳細モデル
│   │   ├── grammar_exercise.dart      # 練習問題モデル
│   │   └── grammar_favorite.dart      # お気に入りモデル（Freezed）
│   └── repositories/
│       ├── grammar_repository.dart    # 文法データ取得
│       └── grammar_favorite_repository.dart  # お気に入り管理
└── domain/
    └── providers/
        └── grammar_providers.dart     # Riverpodプロバイダー
```

### 6.2 UI構成

```
lib/ui/screens/grammar/
├── grammar_list_screen.dart       # 一覧画面
├── grammar_detail_screen.dart     # 詳細画面
├── grammar_favorites_screen.dart  # お気に入り一覧
└── grammar_exercise_screen.dart   # 練習問題画面
```

---

## 7. 画面設計

### 7.1 文法一覧画面

```
┌─────────────────────────────────┐
│  ← 文法辞典              ♡      │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │  🔍 文法名や意味で検索      │ │
│ └─────────────────────────────┘ │
│                                 │
│ [全レベル] [初級] [中級] [上級] │
│                                 │
│ [全て][助詞][語尾][接続][敬語]..│
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │█ 이/가            [初級] ♡ │ │
│ │  主格助詞（〜が）          │ │
│ │  #主格 #基本               │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │█ 을/를            [初級] ♡ │ │
│ │  目的格助詞（〜を）        │ │
│ │  #目的格 #基本             │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

### 7.2 文法詳細画面

```
┌─────────────────────────────────┐
│  ← 이/가             ♡  🔊     │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ [初級] [助詞]               │ │
│ │ 主格助詞（〜が）           │ │
│ │                             │ │
│ │ 名詞の後について、その名詞  │ │
│ │ が文の主語であることを示す  │ │
│ │ 助詞です。                  │ │
│ │                             │ │
│ │ #主格 #基本 #必須           │ │
│ └─────────────────────────────┘ │
│                                 │
│ ■ 活用規則                     │
│ ┌─────────────────────────────┐ │
│ │ 条件        形    例        │ │
│ │ パッチムあり  이  책이      │ │
│ │ パッチムなし  가  사과가    │ │
│ └─────────────────────────────┘ │
│                                 │
│ ■ 用法・用例                   │
│ ┌─────────────────────────────┐ │
│ │ 主語を示す                  │ │
│ │ 文の主語が何かを明確に...   │ │
│ │ ┌─────────────────────────┐ │ │
│ │ │ 사과가 맛있어요.    🔊 │ │ │
│ │ │ サグァガ マシッソヨ     │ │ │
│ │ │ りんごがおいしいです。  │ │ │
│ │ └─────────────────────────┘ │ │
│ └─────────────────────────────┘ │
│                                 │
│ ■ 은/는 との違い               │
│ ...                             │
│                                 │
│ ■ ヒント・コツ                 │
│ • 会話では「가」が省略される... │
│                                 │
│ ┌─────────────────────────────┐ │
│ │ 🎯 練習問題（3問）          │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

---

## 8. データフロー

```
assets/grammar/*.json
        │
        ▼
   AssetBundle.loadString()
        │
        ▼
   jsonDecode → Map<String, dynamic>
        │
        ▼
   Model.fromJson()
        │
        ▼
   Memory Cache + SharedPreferences
        │
        ▼
   Riverpod Provider
        │
        ▼
   ConsumerWidget.watch()
        │
        ▼
   UI表示
```

---

## 9. 実装上の注意点

### 9.1 既存パターンの踏襲

- `LessonRepository` のキャッシュ戦略を踏襲
- `WordbookProviders` の音声再生サービスを再利用
- `KanadaRaScreen` のタブUIパターンを参考
- `AppPageScaffold`, `PageErrorView`, `PageEmptyView` を活用

### 9.2 検索機能

- メモリ内検索（インデックスがロード済みの場合）
- デバウンス処理（入力から300ms後に検索実行）
- 検索対象: タイトル、サブタイトル、タグ

### 9.3 お気に入り

- SharedPreferencesに保存
- Freezedでイミュータブルなデータモデル
- メモ機能付き

---

## 10. 将来の拡張性

- 練習問題の成績管理
- 音声ファイルのオンデマンドダウンロード
