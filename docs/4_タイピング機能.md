# タイピング機能の詳細仕様

## 入力方式
### 独自韓国語キーボード実装
- **カスタムキーボードUI**:
  - Flutter上に独自の韓国語キーボードを実装
  - ネイティブキーボードに依存しない（韓国語設定なしでも利用可能）
  - 2-Set Korean配列（標準的な配列）

- **キーボードレイアウト**:
```
┌────────────────────────────────────────┐
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ   │
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
│     123   🌐    space    ✓   ⏎       │
└────────────────────────────────────────┘
```

- **入力ロジック**:
  - 子音 + 母音の組み合わせをリアルタイムで処理
  - 複合母音・パッチム（終声）の自動組み立て
  - 例: `ㅇ` + `ㅏ` + `ㄴ` → `안`
  - 例: `ㅇ` + `ㅏ` + `ㄴ` + `ㄴ` → `안` + `ㄴ`（次の文字開始）

- **濃音入力**:
  - Shiftキー + 子音で濃音入力
  - 例: Shift + `ㄱ` → `ㄲ`

### 入力検証ロジック
- **文字単位の検証**:
  - 1文字ずつリアルタイムで正誤判定
  - Unicode正規化（NFC形式）で比較
  - 完全一致のみ正解（部分一致や許容モードなし）
  - 例: `안녕` → `ㅇ`,`ㅏ`,`ㄴ` → `안` → `ㄴ`,`ㅕ`,`ㅇ` → `녕`

---

# カスタム韓国語キーボードUI

## キーボード全体レイアウト
```
┌────────────────────────────────────────┐
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │  ← 第1行（子音・母音）
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ   │  ← 第2行（子音・母音）
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │  ← 第3行（子音・母音・削除）
│     123   🌐    space    ✓   ⏎       │  ← 第4行（モード切替・スペース・確定・改行）
└────────────────────────────────────────┘
```

## キーの種類とサイズ
- **文字キー**: 40x48px（タップエリア44x52px、マージン含む）
- **Shiftキー（⇧）**: 60x48px
- **削除キー（⌫）**: 60x48px
- **スペースキー**: 200x48px
- **確定キー（✓）**: 60x48px
- **改行キー（⏎）**: 60x48px
- **数字モード切替（123）**: 80x48px
- **言語切替（🌐）**: 60x48px

## キーボードの状態
### 通常モード
- 基本子音・母音の入力

### Shiftモード（濃音入力）
- Shiftキーを押すと濃音モードに切り替え
- 対応する子音キーをタップで濃音入力
  - ㄱ → ㄲ
  - ㄷ → ㄸ
  - ㅂ → ㅃ
  - ㅅ → ㅆ
  - ㅈ → ㅉ
- Shiftキーは青色にハイライト表示

### ヒント機能
- **次に入力すべき文字のハイライト表示**:
  - 次に入力すべき文字のキーの背景色が黄色（#FFD700）に変化
  - 文字が組み立て中の場合（例: `ㅎ` + `ㅏ` → `하`）、次に必要な母音やパッチムをハイライト
  - スペースが必要な場合はスペースキーがハイライト
  - 濃音が必要な場合は、Shiftキーと対応する子音キーの両方がハイライト

- **ハイライトの動作**:
  - ハイライトは常に「次の1つのキー」のみを表示
  - キーをタップすると、次に入力すべきキーが自動的にハイライトされる
  - 不正解のキーをタップしてもハイライトは変わらない

- **視覚的な表現**:
  - 背景色: 黄色（#FFD700）
  - ボーダー: 2px、オレンジ色（#FFA500）でより目立たせる
  - パルスアニメーション: 0.8秒周期でゆっくり明滅（オプション）

### 数字・記号モード（123）
```
┌────────────────────────────────────────┐
│  1  2  3  4  5  6  7  8  9  0         │
│    -  /  :  ;  (  )  $  @  "          │
│  ⇧  .  ,  ?  !  '  #  %  +  ⌫        │
│    ABC   🌐    space    ✓   ⏎        │
└────────────────────────────────────────┘
```

## キー入力時のフィードバック
- **視覚**: キーをタップ時、背景色が一瞬明るくなる（100ms）
- **触覚**: light impact振動
- **音**: タイプライター風のクリック音（オプション）

## 入力候補表示（組み立て中の文字）
```
┌────────────────────────────────────────┐
│  현재 입력: ㅎ + ㅏ + ㄴ → 한          │  ← 組み立て中の文字を表示
├────────────────────────────────────────┤
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ   │
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
│     123   🌐    space    ✓   ⏎       │
└────────────────────────────────────────┘
```

## ヒント機能の表示例
ヒント機能がONの場合、次に入力すべきキーが黄色でハイライトされます。

### 例1: 「한국」を入力する場合
**ステップ1**: 最初の文字 `ㅎ` を入力する前
```
┌────────────────────────────────────────┐
│  問題: 한국                            │
│  입力: __                              │
├────────────────────────────────────────┤
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │
│    ㅁ  ㄴ  ㅇ  ㄹ [ㅎ] ㅗ  ㅓ  ㅏ  ㅣ  │  ← ㅎ が黄色でハイライト
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
└────────────────────────────────────────┘
```

**ステップ2**: `ㅎ` を入力後、次は `ㅏ` をハイライト
```
┌────────────────────────────────────────┐
│  問題: 한국                            │
│  입력: ㅎ_                             │
├────────────────────────────────────────┤
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ [ㅏ] ㅣ  │  ← ㅏ が黄色でハイライト
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
└────────────────────────────────────────┘
```

**ステップ3**: `ㅏ` を入力後、次は `ㄴ`（パッチム）をハイライト
```
┌────────────────────────────────────────┐
│  問題: 한국                            │
│  입력: 하_                             │
├────────────────────────────────────────┤
│  ㅂ  ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │
│    ㅁ [ㄴ] ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ  │  ← ㄴ が黄色でハイライト
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
└────────────────────────────────────────┘
```

**ステップ4**: `ㄴ` を入力後、次は `ㄱ` をハイライト
```
┌────────────────────────────────────────┐
│  問題: 한국                            │
│  입력: 한_                             │
├────────────────────────────────────────┤
│  ㅂ  ㅈ  ㄷ [ㄱ] ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │  ← ㄱ が黄色でハイライト
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ  │
│  ⇧  ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │
└────────────────────────────────────────┘
```

### 例2: 濃音「빠르다」の「ㅃ」を入力する場合
濃音が必要な場合は、Shiftキーと子音キーの両方がハイライトされます。
```
┌────────────────────────────────────────┐
│  問題: 빠르다                          │
│  입力: __                              │
├────────────────────────────────────────┤
│ [ㅂ] ㅈ  ㄷ  ㄱ  ㅅ  ㅛ  ㅕ  ㅑ  ㅐ  ㅔ │  ← ㅂ が黄色でハイライト
│    ㅁ  ㄴ  ㅇ  ㄹ  ㅎ  ㅗ  ㅓ  ㅏ  ㅣ  │
│ [⇧] ㅋ  ㅌ  ㅊ  ㅍ  ㅠ  ㅜ  ㅡ  ⌫      │  ← ⇧ も黄色でハイライト
└────────────────────────────────────────┘
※ 「Shift + ㅂ を同時に押してください」のようなメッセージを表示
```

## キーボードのカスタマイズ
- **キーボードテーマ**: ライト/ダーク/カスタム
- **キー音のON/OFF**: 設定画面で切り替え
- **振動のON/OFF**: 設定画面で切り替え
- **キーサイズ**: 小/中/大（アクセシビリティ）
- **ヒント機能のON/OFF**: 設定画面で切り替え
  - デフォルト: ON（初心者向け）
  - レッスン中でもヘッダーの設定ボタンから即座に切り替え可能
  - 設定は次回以降のレッスンにも保持される

---

# タイピング画面

## 画面構成
```
┌─────────────────────────────────┐
│  ← レッスン1: 基本の子音と母音  │  ← ヘッダー（戻るボタン + タイトル）
│  進捗: ███████░░░ 70%          │  ← プログレスバー
├─────────────────────────────────┤
│                                 │
│      問題: 나무                 │  ← 問題文（大きく表示）
│      (나무: 木)                 │  ← 意味表示
│                                 │
│      入力: 나__                 │  ← 入力中の文字
│            ✓✗                   │  ← 正誤インジケーター
│                                 │
├─────────────────────────────────┤
│  スコア: 85点  正解率: 92%     │  ← 統計情報
│  スピード: 45文字/分            │
├─────────────────────────────────┤
│                                 │
│    [カスタム韓国語キーボード]    │  ← キーボード
│                                 │
└─────────────────────────────────┘
```

## ヘッダー
- **戻るボタン**: ← アイコン、タップで確認ダイアログ表示
  - 「レッスンを中断しますか？」→ はい/いいえ
- **レッスンタイトル**: レッスン番号 + タイトル
- **設定ボタン**: ⚙️ アイコン、クイック設定メニュー表示
  - キー音のON/OFF
  - 振動のON/OFF
  - ヒント機能のON/OFF（次に入力すべきキーのハイライト表示）

## プログレスバー
- **進捗率**: パーセンテージ表示（例: 70%）
- **ビジュアル**: グラデーション付きプログレスバー
- **アニメーション**: スムーズに増加

## 問題文エリア
- **問題文**: 28px、Bold、中央揃え
- **意味表示**: 16px、Regular、グレー、括弧付き
- **背景**: 薄いグレー（ライトモード）/ ダークグレー（ダークモード）
- **余白**: 上下24px、左右16px

## 入力エリア
- **入力中の文字**: 28px、等幅フォント
- **カーソル**: 点滅するライン
- **正誤インジケーター**:
  - ✓ 緑色（正解）
  - ✗ 赤色（不正解）

## 統計情報バー
- **スコア**: 現在のポイント
- **正解率**: パーセンテージ
- **スピード**: 文字/分（WPM）
- **レイアウト**: 横並び、均等配置

## リアルタイムフィードバック
### 文字単位フィードバック
- **入力中**: グレーのアンダーライン
- **正解**: 緑色に変化 + チェックマーク(✓) + パルスアニメーション
- **不正解**: 赤色に変化 + バツマーク(✗) + 横揺れアニメーション + 正しい文字を表示

### 単語完了時
- **完璧（ミスなし）**: 「완벽!」アニメーション + キラキラエフェクト
- **良い（1〜2ミス）**: 「좋아!」表示
- **要改善（3ミス以上）**: 「다시 해보세요」+ 再挑戦提案

## レッスン完了画面
```
┌─────────────────────────────────┐
│         🎉 완성! 🎉             │  ← 花吹雪アニメーション
│                                 │
│      レッスン1 完了！           │
│                                 │
│  ┌───────────────────────┐     │
│  │  スコア: 92点          │     │  ← カウントアップアニメーション
│  │  正解率: 95%           │     │
│  │  スピード: 48文字/分   │     │
│  │  所要時間: 8分30秒     │     │
│  └───────────────────────┘     │
│                                 │
│  ┌───────────────────────┐     │
│  │  弱点文字: ㅈ, ㅊ, ㅉ   │     │
│  │  復習をおすすめします   │     │
│  └───────────────────────┘     │
│                                 │
│  [次のレッスン]  [ホームに戻る]  │
└─────────────────────────────────┘
```