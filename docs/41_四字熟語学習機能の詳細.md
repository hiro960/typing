# 四字熟語（사자성어）学習機能 仕様書

## 概要

韓国語の四字熟語（사자성어）を効率的に学習するための機能。
TOPIK受験者をメインターゲットとし、試験対策に効果的な学習体験を提供する。

---

## ターゲットユーザー

- **メイン**: TOPIK（韓国語能力試験）受験者
- **サブ**: 上級学習者、韓国文化に興味のある学習者

---

## 機能一覧

### 1. 四字熟語辞典

#### 1.1 一覧表示
- TOPIKレベル別グループ化
  - TOPIK I（初級: 1-2級）
  - TOPIK II 中級（3-4級）
  - TOPIK II 高級（5-6級）
- リスト/グリッド表示切り替え
- ソート順:
  - 가나다順（韓国語の初声順）
  - 難易度順

#### 1.2 検索機能
- 韓国語での検索（例: 일석이조）
- 漢字での検索（例: 一石二鳥）
- 日本語意味での検索（例: 二つの利益）
- タグ・カテゴリでのフィルタリング

#### 1.3 詳細表示
各四字熟語について以下を表示：

| 項目 | 説明 | 例 |
|------|------|-----|
| 韓国語表記 | ハングル表記 | 일석이조 |
| 漢字表記 | 漢字での表記 | 一石二鳥 |
| 発音 | 音声再生ボタン付き | ― |
| 意味 | 日本語での意味 | 一つの行動で二つの利益を得ること |
| 由来・語源 | 成り立ちの説明 | 一つの石を投げて二羽の鳥を落とすことから |
| 例文 | 韓国語例文+日本語訳 | 이 계획은 일석이조의 효과가 있다. |
| 関連熟語 | 類似・対義の熟語 | 일거양득（一挙両得） |

---

### 2. 暗記カード（フラッシュカード）

スワイプ操作による効率的な暗記学習。

#### 2.1 カード構成
- **表面**: 四字熟語（韓国語）
- **裏面**:
  - 漢字表記
  - 意味
  - 例文

#### 2.2 学習フロー
1. カードをタップして裏面表示
2. スワイプで習得度を評価
   - 右スワイプ: 覚えた
   - 左スワイプ: まだ覚えていない

---

### 3. クイズ機能

多様な出題形式で学習効果を高める。

#### 3.1 出題形式

| 形式 | 説明 |
|------|------|
| 意味選択 | 熟語を見て正しい意味を4択で選ぶ |
| 熟語選択 | 意味を見て正しい熟語を4択で選ぶ |
| 穴埋め問題 | 例文の空欄に入る熟語を選ぶ |
| 漢字対応 | 韓国語と漢字の対応を選ぶ |

#### 3.2 クイズ設定
- 出題数: 10/20/30/50問
- 難易度: TOPIKレベル指定
- 範囲: 全体/学習中のみ

#### 3.3 選択肢生成ルール

**基本ルール**
- 正解1つ + 不正解3つの4択形式
- 不正解選択肢は同じTOPIKレベルから抽出

**形式別ルール**

| 形式 | 選択肢生成方法 |
|------|---------------|
| 意味選択 | 意味が類似しすぎない熟語を選択（同カテゴリ内で分散） |
| 熟語選択 | 初声が同じ、または字数が同じ熟語を優先的に混ぜる |
| 穴埋め問題 | 文脈的に入りそうな熟語を選択 |
| 漢字対応 | 一部の漢字が共通する紛らわしい組み合わせを含める |

**除外条件**
- 正解と意味がほぼ同一の熟語（類義語）は不正解から除外
- relatedIdiomIds に含まれる関連熟語は除外（正解が複数になるため）

---

### 4. 進捗管理

#### 4.1 学習ステータス
各四字熟語に以下のステータスを設定：

| ステータス | 説明 | 表示色 |
|------------|------|--------|
| 未学習 | まだ学習していない | グレー |
| 学習中 | 現在学習中 | 青 |
| 復習中 | 復習が必要 | 黄 |
| 習得済み | 十分に習得 | 緑 |

#### 4.2 統計データ
- 学習済み熟語数 / 全体数
- 正答率（全体/レベル別）

---

## データ構造

### JSONファイル配置

```
application/assets/idiom/
├── topik1.json      # TOPIK I（初級: 1-2級）
├── topik2_mid.json  # TOPIK II 中級（3-4級）
└── topik2_adv.json  # TOPIK II 高級（5-6級）
```

### JSONスキーマ

```json
{
  "idioms": [
    {
      "id": "idiom_001",
      "korean": "일석이조",
      "hanja": "一石二鳥",
      "pronunciation": "ilseokijo",
      "meaning": "一つの行動で二つの利益を得ること",
      "origin": "一つの石を投げて二羽の鳥を落とすことから",
      "examples": [
        {
          "korean": "이 계획은 {{idiom}}의 효과가 있다.",
          "japanese": "この計画は一石二鳥の効果がある。"
        }
      ],
      "difficulty": 2,
      "tags": ["日常", "ビジネス"],
      "relatedIdiomIds": ["idiom_002"]
    }
  ]
}
```

**注意**: 例文内の `{{idiom}}` は四字熟語の位置を示すプレースホルダーです。
- 辞典表示時: `{{idiom}}` → 実際の四字熟語に置換
- クイズ（穴埋め）時: `{{idiom}}` → `______` に置換して出題

### Dartデータモデル

#### Idiom（四字熟語）

```dart
@freezed
class Idiom with _$Idiom {
  const factory Idiom({
    required String id,
    required String korean,         // 韓国語表記（일석이조）
    required String hanja,          // 漢字表記（一石二鳥）
    required String pronunciation,  // 発音ガイド
    required String meaning,        // 日本語意味
    String? origin,                 // 由来・語源
    required List<IdiomExample> examples, // 例文リスト
    required int difficulty,        // 難易度（1-5）
    @Default(<String>[]) List<String> tags,  // タグ（カテゴリ）
    @Default(<String>[]) List<String> relatedIdiomIds, // 関連熟語ID
  }) = _Idiom;

  factory Idiom.fromJson(Map<String, dynamic> json) => _$IdiomFromJson(json);
}
```

#### IdiomExample（例文）

```dart
@freezed
class IdiomExample with _$IdiomExample {
  const factory IdiomExample({
    required String korean,    // 韓国語例文
    required String japanese,  // 日本語訳
  }) = _IdiomExample;

  factory IdiomExample.fromJson(Map<String, dynamic> json) => _$IdiomExampleFromJson(json);
}
```

#### IdiomProgress（学習進捗）

```dart
@freezed
class IdiomProgress with _$IdiomProgress {
  const factory IdiomProgress({
    required String idiomId,
    required IdiomStatus status,     // 学習ステータス
    required int reviewCount,        // 復習回数
    required double successRate,     // 正答率
    DateTime? lastReviewedAt,        // 最終学習日時
  }) = _IdiomProgress;

  factory IdiomProgress.fromJson(Map<String, dynamic> json) => _$IdiomProgressFromJson(json);
}

enum IdiomStatus {
  notStarted,  // 未学習
  learning,    // 学習中
  reviewing,   // 復習中
  mastered,    // 習得済み
}

enum TopikLevel {
  topik1,    // TOPIK I（1-2級）
  topik2Mid, // TOPIK II 中級（3-4級）
  topik2Adv, // TOPIK II 高級（5-6級）
}
```

---

## 画面構成

### ホーム画面への追加

`home_screen.dart` の機能グリッド（`_FeatureGrid`）に四字熟語アイテムを追加する。

#### 追加するコード

**app_theme.dart - FeatureGradients**
```dart
// 12. 四字熟語 - ジェイドティール
static const idiom = [Color(0xFF33C4B3), Color(0xFF63D9C8)];
```

**home_screen.dart - _FeatureGrid**
```dart
_FeatureItem(
  title: '四字熟語',
  icon: Iconsax.text_block,
  gradientColors: FeatureGradients.idiom,
  onTap: _openIdiom,
),
```

**home_screen.dart - 遷移メソッド**
```dart
void _openIdiom() {
  Navigator.of(context).push(
    MaterialPageRoute<void>(
      builder: (_) => const IdiomHomeScreen(),
    ),
  );
}
```

### 画面一覧

| 画面名 | パス | 説明 |
|--------|------|------|
| 四字熟語ホーム | `/idiom` | 学習進捗サマリー |
| 辞典一覧 | `/idiom/dictionary` | 一覧表示、検索、フィルタ |
| 熟語詳細 | `/idiom/dictionary/:id` | 個別熟語の詳細情報 |
| フラッシュカード | `/idiom/flashcard` | 暗記カード学習 |
| クイズ | `/idiom/quiz` | クイズ出題画面 |
| クイズ結果 | `/idiom/quiz/result` | クイズ結果・分析 |

### 画面遷移図

```
ホーム画面（機能グリッド）
    └── 四字熟語ホーム
        ├── 辞典一覧 → 熟語詳細
        ├── フラッシュカード
        └── クイズ → クイズ結果
```

---

## UI設計

### 1. 四字熟語ホーム画面

学習機能への入口となるダッシュボード画面。

```
┌─────────────────────────────────────┐
│  ← 四字熟語                         │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │  学習進捗                    │   │
│  │  ████████░░ 80/600語        │   │
│  │  TOPIK I: 30/100            │   │
│  │  TOPIK II中級: 35/200       │   │
│  │  TOPIK II高級: 15/300       │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌───────────┐ ┌───────────┐       │
│  │ 📖 辞典   │ │ 🃏 暗記   │       │
│  │           │ │  カード   │       │
│  └───────────┘ └───────────┘       │
│  ┌───────────┐                     │
│  │ ❓ クイズ │                     │
│  │           │                     │
│  └───────────┘                     │
└─────────────────────────────────────┘
```

**構成要素**
- `AppPageScaffold` - 共通レイアウト
- 学習進捗カード - 全体/レベル別の進捗表示
- 機能カード（3つ）- 辞典・暗記カード・クイズへの導線

### 2. 辞典一覧画面

四字熟語の一覧表示・検索画面。

```
┌─────────────────────────────────────┐
│  ← 四字熟語辞典          🔍 ⚙️    │
├─────────────────────────────────────┤
│  ┌─────────────────────────────┐   │
│  │ 🔎 検索...                  │   │
│  └─────────────────────────────┘   │
│                                     │
│  [TOPIK I] [TOPIK II中] [TOPIK II高]│
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 일석이조  一石二鳥          │   │
│  │ 一つの行動で二つの利益...   │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ 일거양득  一挙両得          │   │
│  │ 一つの行動で二つの得...     │   │
│  └─────────────────────────────┘   │
│  ...                               │
└─────────────────────────────────────┘
```

**構成要素**
- 検索バー - キーワード検索（韓国語/漢字/日本語意味）
- タブ/フィルタ - TOPIKレベル別切り替え
- リスト表示 - 熟語カード（タップで詳細へ）
- ソートオプション - 가나다順/難易度順

### 3. 熟語詳細画面

個別の四字熟語の詳細情報表示。

```
┌─────────────────────────────────────┐
│  ←                        🔊 ⭐    │
├─────────────────────────────────────┤
│         일석이조                    │
│         一石二鳥                    │
│                                     │
│  ─────────────────────────────────  │
│  意味                               │
│  一つの行動で二つの利益を得ること   │
│                                     │
│  ─────────────────────────────────  │
│  由来                               │
│  一つの石を投げて二羽の鳥を...     │
│                                     │
│  ─────────────────────────────────  │
│  例文                               │
│  이 계획은 일석이조의 효과가 있다.  │
│  この計画は一石二鳥の効果がある。   │
│                                     │
│  ─────────────────────────────────  │
│  関連する四字熟語                   │
│  ┌─────────┐                       │
│  │일거양득 │                       │
│  └─────────┘                       │
└─────────────────────────────────────┘
```

**構成要素**
- ヘッダー - 音声再生ボタン、お気に入りボタン
- メインカード - 韓国語表記（大）、漢字表記
- 意味セクション
- 由来セクション（ある場合）
- 例文セクション
- 関連熟語セクション（タップで遷移）

### 4. フラッシュカード画面

スワイプ操作による暗記学習。

```
┌─────────────────────────────────────┐
│  ← 暗記カード            3/50      │
├─────────────────────────────────────┤
│                                     │
│       ┌───────────────────┐        │
│       │                   │        │
│       │    일석이조       │        │
│       │                   │        │
│       │   (タップで裏面)  │        │
│       │                   │        │
│       └───────────────────┘        │
│                                     │
│    ← まだ        覚えた →          │
│                                     │
│  ████████░░░░░░░░░░░░ 30%          │
└─────────────────────────────────────┘
```

**裏面表示時**
```
┌───────────────────┐
│    일석이조       │
│    一石二鳥       │
│                   │
│ 一つの行動で二つ  │
│ の利益を得ること  │
│                   │
│ 例: 이 계획은...  │
└───────────────────┘
```

**操作**
- タップ: カード反転（表⇔裏）
- 左スワイプ: まだ覚えていない
- 右スワイプ: 覚えた

### 5. クイズ画面

4択形式のクイズ出題。

```
┌─────────────────────────────────────┐
│  ← クイズ                 5/20     │
├─────────────────────────────────────┤
│                                     │
│  Q. 다음 사자성어의 뜻은?          │
│                                     │
│       ┌───────────────────┐        │
│       │    일석이조       │        │
│       └───────────────────┘        │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ A. 努力して成功すること     │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ B. 一つで二つの利益を得る   │ ← │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ C. 時間を無駄にすること     │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │ D. 人を助けること           │   │
│  └─────────────────────────────┘   │
│                                     │
│  ████████████░░░░░░░░ 60%          │
└─────────────────────────────────────┘
```

**正解/不正解フィードバック**
- 正解: 緑色ハイライト + アニメーション
- 不正解: 赤色ハイライト + 正解を緑で表示

### 6. クイズ結果画面

クイズ終了後の結果表示。

```
┌─────────────────────────────────────┐
│  クイズ結果                         │
├─────────────────────────────────────┤
│                                     │
│         🎉                          │
│       85点                          │
│     17/20問正解                     │
│                                     │
│  ─────────────────────────────────  │
│  形式別正答率                       │
│  意味選択: 90%                      │
│  熟語選択: 80%                      │
│  穴埋め: 85%                        │
│  漢字対応: 85%                      │
│                                     │
│  ─────────────────────────────────  │
│  間違えた問題                       │
│  ┌─────────────────────────────┐   │
│  │ 일거양득 → 確認する         │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │       もう一度挑戦          │   │
│  └─────────────────────────────┘   │
│  ┌─────────────────────────────┐   │
│  │         終了                │   │
│  └─────────────────────────────┘   │
└─────────────────────────────────────┘
```

**構成要素**
- スコア表示（点数、正解数）
- 形式別正答率
- 間違えた問題リスト（タップで詳細へ）
- アクションボタン（再挑戦/終了）

---

## 既存機能との連携

### ワードブック
- 四字熟語をワードブックに追加可能
- 例文もセットで追加

### 統計機能
- 全体の学習統計に四字熟語の進捗を統合
- 正答率の集計

---

## 実装優先度

### Phase 1: 基盤機能
1. JSONデータ作成（TOPIKレベル別）
2. データモデル実装
3. 四字熟語辞典（一覧・詳細・検索）

### Phase 2: 学習機能
4. フラッシュカード
5. クイズ機能（4形式）
6. 学習進捗管理

### Phase 3: 連携・最適化
7. ワードブック連携
8. 統計機能統合

---

## 四字熟語データ作成方針

### 収録数目安
- TOPIK I: 約100語
- TOPIK II 中級: 約200語
- TOPIK II 高級: 約300語
- **合計: 約600語**

### データソース
- TOPIK過去問から抽出
- 韓国語教材・辞典から補完
- 日韓共通の四字熟語を優先

### カテゴリ例（タグ）
- 人間関係・社会生活
- 学問・努力
- 自然・季節
- 感情・心理
- ビジネス・仕事
- 歴史・故事

---

## 参考

- 既存の単語帳機能: `docs/12_単語帳機能の詳細.md`
- 漢字学習機能: `docs/27_漢字語辞典作成計画.md`
