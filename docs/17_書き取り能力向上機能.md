# 書き取り能力向上機能

## 1. 目的
- TOPIKⅡの書き取り問題で求められる構成力と表現力を、タイピング練習を通じて定着させる。
- 汎用的な論述パターンの型を身体化し、短時間で骨子を組み立てられる状態をゴールとする。
- 語彙のレベルアップ（基礎→高級表現）と文章構成テンプレートの往復練習で、実戦での再現性を高める。

## 2. 学習体験の原則
- 「タイピングで記憶」: クリック選択ではなく必ず入力させ、手癖で型と表現を覚える。
- 「即時で気持ちよいフィードバック」: セクション単位で即合否と修正候補を表示し、1セクション5秒以内で再挑戦可能にする。

## 3. ユースケース
- 直前対策: 定番パターンを15分で総ざらいしたい。
- 苦手補強: 「原因と結果」の接続語が弱いので集中的に打ち込みたい。
- 表現の格上げ: 基礎語彙でしか書けない文章を、高級語彙に置き換えてみたい。

## 4. パターン別テンプレート支援（タイピングで覚える）

### 4.1 対応パターン
※ `patternId` は下記の型（構成パターン）そのものを指し、`topicId` は各型の題材（環境/教育などのトピック）を指す。データは `{ patternId, topicId, entries[] }` で保持し、同一パターンでも題材ごとに `topicId` を分ける。
- グラフ・資料描写（増減/割合/比較）※TOPIK53対策
- 意見文（主張＋根拠）※TOPIK54対策
- 賛成・反対（立場明示＋反論処理）
- 原因と結果
- 問題と解決策
- 導入・本論・結論（総論型）
- 比較対照 / 長所短所
- 提案・代案提示（提言・施策）
- 例示・具体化（例→分析→まとめ）

### 4.2 レッスン構造（シンプル版）
- 画面構成: `パターン一覧` → `トピック選択` → 「タイピング練習」or「一覧で確認」。
- タイピング練習: 画面上に日本語の骨子（導入/理由/結論など）を1行ずつ表示し、対応する韓国語を入力。行ごとに即判定。
- 一覧で確認: 日本語と韓国語の対応表をまとめて閲覧し、キーフレーズを確認する読み物モード。
- 難度調整: 「答え表示ON/OFF」（韓国語行を隠す/見せる）のみ。段階選択や細かいスロット後設定はなし。
- 出題順: タイピング練習の行表示はランダム順（一覧表示は原文順）。

### 4.3 入力とフィードバック
- 判定方式: 完全一致で採点（空白・句読点・文体差も許容なし、トリム/正規化なし）。
- 入力方式: 日本語骨子の下に韓国語入力欄。Enterで即判定し、正解例を短く表示。
- ヒントトグル: 韓国語行を折りたたみ表示。ヒントなしで入力→開いて確認→再挑戦の流れを想定。
- まとめチェック: 1パターンの全行完了後に「型の行が埋まったか」を簡易チェック。進捗バー等は持たない。

### 4.4 スコアリングと記録
- 判定結果: 行単位で「正答/不一致」を記録し、部分一致スコアは持たない。
- 完了データ: `patternId`, `topicId`, `mode(typing/list)`, `timeSpent` を端末ローカルに保存。

### 4.5 コンテンツデータ例（テンプレート/語彙で共通）
- 日本語（`jpText`）と韓国語（`koText`）を1:1で持ち、日本語を見ながら韓国語を入力する。`level`で性質を示し、`template`は骨子文、`basic/advanced/sentence`は語彙・例文を表す。
```json
{
  "patternId": "intro_body_conclusion",
  "topicId": "environment",
  "entries": [
    { "id": "env_template_001", "level": "template", "jpText": "しないといけないなと思った", "koText": "해야 한다고 생각한다." }
  ]
}
```

## 5. 語彙強化モード

### 5.1 目的
- 基礎語彙と高級語彙の対応を、日本語訳を見ながら韓国語入力で定着させる。
- トピック別に頻出語を束ね、作文テンプレートと同じ文脈で即使えるようにする。

### 5.2 コンテンツ構成
- 上位トピック例: 社会・教育・環境・経済・テクノロジー・文化/世代・健康/福祉。
- ユニット構造: `jpText`（日本語訳）と`koText`（韓国語）を1:1で保持。`level`タグ（template/basic/advanced/sentence）で性質を示すが、出題は常に日本語→韓国語入力。
- 表示切替: 「日本語のみ表示」「答えを表示」トグルで確認。出題順は常にランダム。
- 例文（`level: sentence`）は閲覧用のみで、出題対象外。
- データ構造は4.5のテンプレートと共通。

### 5.3 学習フロー
- リスト表示でトピックを選択し、各エントリの日本語を見ながら韓国語を入力。Enterで即判定し正答を表示。
- 履歴は端末ローカルに保持するのみ（自動再提示は行わない）。
- 例文は参照のみで、入力や判定の対象に含めない。

### 5.4 データ構造例
```json
{
  "topicId": "environment",
  "entries": [
    { "id": "env_adv_001", "level": "advanced", "jpText": "増加する", "koText": "증가하다" },
    { "id": "env_adv_002", "level": "advanced", "jpText": "急増する", "koText": "급증하다" },
    { "id": "env_sentence_001", "level": "sentence", "jpText": "最近プラスチック使用量が急増している。", "koText": "최근 플라스틱 사용량이 급증하고 있다." }
  ]
}
```

## 6. 非機能・UX要件
- 立ち上がりの速さ: モード切替〜最初のスロット入力まで3タップ以内。
- 手元完結: 必須情報（トピック・骨子・接続語）は同一画面上に折りたたみ表示し、スクロール不要を目指す。
- 完全オフライン: パターン定義・語彙データ・学習履歴は端末ローカルに保持し、バックエンド通信は行わない。
- アクセシビリティ: フォントサイズ調整と高コントラストテーマをサポート。タイマーは音なしでも視認できるアニメーション。

## 7. UI/UX設計（`typing_lesson_screen` をベースに簡素化）

- 画面構成: `パターン一覧`（9型）→ `トピック選択`（題材）→ 「タイピング練習」 or 「一覧で確認」。語彙モードも同じ導線。
- タイピング練習ビュー:
  - ヘッダー: 戻る＋設定（トグル: 答え表示、ヒント表示、フォントサイズ）。タイトルは「パターン名 / トピック名」。
  - 本文: 日本語骨子/日本語訳を上段に表示し、`答え表示`で韓国語例文を折りたたみ。行順はロード時にランダム固定。
  - 入力と判定: 既存キーボードを流用し、Enterで即判定。完全一致のみ。`_InputFeedback`の緑/赤アニメで「正解/不一致」を表示し、正解例を短く提示して次行へ自動遷移。再提示や精度集計なし。
  - 進捗: シンプルな進捗バー＋経過タイマーのみ。精度パーセンテージ表示は行わない。
  - 完了: 全行通過で完了画面へ。保存は `patternId`, `topicId`, `mode(typing/list)`, `timeSpent`, 行ごとの判定履歴。
- 一覧で確認ビュー: 原文順で `jpText` と `koText` を縦積み表示し、`level` バッジで種別を示す。例文（sentence）は閲覧のみ。常に入力欄なし。
- 語彙モード: トピック選択後の出題順は毎回ランダム。例文は出題対象外で、参照のみ。
