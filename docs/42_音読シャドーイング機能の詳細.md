# 音読・シャドーイング機能 仕様書

## 概要

音読・シャドーイングは、韓国語の**発音・リスニング力・イントネーション**を総合的に鍛える学習機能です。既存の「発音ゲーム」がスコアを競うゲーム形式であるのに対し、本機能は**じっくり反復練習**することで発音を体に染み込ませることを目的とします。

### 既存機能との差別化

| 機能 | 発音ゲーム | 音読・シャドーイング |
|------|-----------|-------------------|
| 目的 | スコア競争、瞬発力 | 発音の定着、リスニング力向上 |
| 形式 | 制限時間あり | 自分のペースで反復 |
| コンテンツ | 単語中心 | 長めの文章（段落レベル） |

---

## 学習体験設計（気持ちよく学習できるポイント）

### 1. スムーズな操作感
- ワンタップで再生/停止
- スワイプで前後のコンテンツに移動
- 長押しで区間リピート設定

### 2. 段階的な達成感
- 各コンテンツに「マスター度」を表示（練習回数ベース）
- 20回練習すると「習得済み」バッジ付与

### 3. 自分のペースで学習
- 再生速度調整（0.5x / 0.75x / 1.0x / 1.25x）
- 区間リピート（A-Bリピート）で苦手な部分を集中練習
- テキスト表示のON/OFF切り替え（シャドーイング用）

### 4. 即座のフィードバック
- 発音のポイント表示（連音化、濃音化などの注意点）
- 自分の声を録音してお手本と比較

### 5. セグメント再生 + 自動ハイライト（シャドーイング精度向上）
- **文/句単位でテキストが自動ハイライト**（現在再生中の部分が追従表示）
- **タップでその文だけ再生**（苦手な箇所を重点練習）
- 音声と同期した滑らかなハイライト移動
- 長押しでセグメント区間リピートも可能

---

## 学習モード

### モード1: リスニング（聞くだけ）
- 音声を聞いて耳を慣らす
- テキストを見ながら意味を確認
- **用途**: 初めてのコンテンツに触れる時

### モード2: 音読（テキストを見ながら発声）
- テキストを見ながら声に出して読む
- 自分の発音を録音・再生
- **用途**: 発音を確認しながら練習

### モード3: シャドーイング（音声に続いて発声）
- お手本音声を聞きながら少し遅れて発声
- テキスト非表示を推奨（設定で変更可）
- **用途**: イントネーション・リズム感の習得

### モード4: リピート・アフターミー
- お手本音声を聞く → 停止 → 自分が発声
- **用途**: 正確な発音の習得

---

## コンテンツ構成

### 初級（TOPIK 1-2）- 20コンテンツ
```
コンテンツ例:
- 自己紹介（名前、出身、趣味など3〜5文程度）
- 家族紹介
- 日常の1日を説明する文章
- 好きな食べ物について
- 週末の予定を話す
- 道案内のやりとり
- カフェでの注文シーン
- 買い物での会話
- 天気について話す
- 簡単な日記文
```

### 中級（TOPIK 3-4）- 30コンテンツ
```
コンテンツ例:
- ニュースの要約文
- 韓国の文化紹介
- 旅行体験を話す
- 映画・ドラマの感想
- 仕事について説明する
- 健康・運動について
- 環境問題についての意見
- 韓国の祝日・行事
- ことわざを使った文章
- インタビュー形式の会話
```

### 高級（TOPIK 5-6）- 40コンテンツ
```
コンテンツ例:
- ニュース記事の一節
- 社説・コラム
- ビジネスプレゼンの一部
- 学術的な説明文
- 討論での意見表明
- 文学作品の一節
- 歴史的な出来事の説明
- 専門分野の解説
- 敬語を多用した会話
- スピーチ・演説文
```

---

## 画面設計

### ホーム（音読・シャドーイング）

```
┌─────────────────────────────────┐
│  ← 音読・シャドーイング           │
├─────────────────────────────────┤
│                                 │
│  レベルを選択                    │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 🟢 初級 (TOPIK 1-2)     │   │
│  │    8/20 マスター         │   │
│  │    全20コンテンツ        │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 🟡 中級 (TOPIK 3-4) 👑  │   │
│  │    5/30 マスター         │   │
│  │    全30コンテンツ        │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 🔴 高級 (TOPIK 5-6) 👑  │   │
│  │    2/40 マスター         │   │
│  │    全40コンテンツ        │   │
│  └─────────────────────────┘   │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✨ オリジナル文章   👑   │   │
│  │    自分だけの文章で練習   │   │
│  │    3件登録済み           │   │
│  └─────────────────────────┘   │
│                                 │
└─────────────────────────────────┘
```

※ 👑マークは有料会員限定コンテンツを示す

### コンテンツ一覧画面

```
┌─────────────────────────────────┐
│  ← 初級 (TOPIK 1-2)             │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✓ 自己紹介をしよう       │   │
│  │   저는 일본에서 온...     │   │
│  │   ⏱️ 0:45               │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✓ 私の家族               │   │
│  │   우리 가족은 네 명...    │   │
│  │   ⏱️ 0:52               │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │   今日の1日              │   │
│  │   오늘 아침에 일어나서... │   │
│  │   ⏱️ 1:05               │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │   好きな食べ物           │   │
│  │   제가 제일 좋아하는...   │   │
│  │   ⏱️ 0:38               │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │   週末の予定             │   │
│  │   이번 주말에는 친구...   │   │
│  │   ⏱️ 0:55               │   │
│  └─────────────────────────┘   │
│                                 │
│         ... (20コンテンツ)      │
│                                 │
└─────────────────────────────────┘
```

※ ✓マークは1回以上練習済みを示す

### 練習画面（メイン）- セグメントハイライト対応

```
┌─────────────────────────────────┐
│  ← 自己紹介をしよう     ⚙️      │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐   │
│  │                         │   │
│  │  저는 일본에서 온 사토입  │ ← タップで再生 │
│  │  니다.                  │   │
│  │  ━━━━━━━━━━━━━━━━━━━   │ ← ハイライト中 │
│  │  지금 서울에서 한국어를   │   │
│  │  공부하고 있습니다.       │   │
│  │  ━━━━━━━━━━━━━━━━━━━   │   │
│  │  취미는 음악 듣기와 여행  │   │
│  │  입니다.                 │   │
│  │  ━━━━━━━━━━━━━━━━━━━   │   │
│  │  한국 음식도 정말 좋아합  │   │
│  │  니다.                  │   │
│  │  ... (スクロール可能)    │   │
│  │                         │   │
│  └─────────────────────────┘   │
│                                 │
│  日本語訳を表示 ▼               │
│                                 │
│  💡 発音ポイント                │
│  「습니다」は「スムニダ」のよう  │
│  に「ㅂ」が「ム」に近くなります │
│                                 │
│  ─────●───────────── 0:25/0:45 │
│  0.5x  0.75x [1.0x]  1.25x     │
│                                 │
│     ⏮️    ▶️/⏸️    ⏭️           │
│                                 │
│  ┌──────┐  ┌──────┐  ┌──────┐  │
│  │ 🔊   │  │ 🎙️   │  │ 🔁   │  │
│  │ 聞く │  │ 録音 │  │リピート│ │
│  └──────┘  └──────┘  └──────┘  │
│                                 │
│  ────────────────────────────  │
│  練習回数: 3/20 (あと17回でマスター) │
│                                 │
└─────────────────────────────────┘
```

**セグメントハイライトの動作:**
- 再生中は現在の文/句がハイライト表示（背景色変更 + 太字）
- 再生位置に応じて自動的にスクロール追従
- 各セグメント（文）をタップするとその部分だけを再生
- 長押しでそのセグメントのみリピート設定

### 録音・比較画面

```
┌─────────────────────────────────┐
│  ← 録音比較                     │
├─────────────────────────────────┤
│                                 │
│  自己介をしよう               │
│                                 │
│  お手本                         │
│  ┌─────────────────────────┐   │
│  │ ▶️ ▁▂▃▅▆▅▃▂▁▂▃▅ 0:45    │   │
│  └─────────────────────────┘   │
│                                 │
│  あなたの発音                   │
│  ┌─────────────────────────┐   │
│  │ ▶️ ▁▂▄▅▅▄▂▁▁▂▄▅ 0:47    │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌────────────────────────┐    │
│  │      🎙️ もう一度録音    │    │
│  └────────────────────────┘    │
│                                 │
└─────────────────────────────────┘
```

### 簡易フィードバックスコア画面（プレミアム限定）

```
┌─────────────────────────────────┐
│  ← 発音フィードバック           │
├─────────────────────────────────┤
│                                 │
│   ┌───────────────────────┐    │
│   │      総合スコア        │    │
│   │        85/100         │    │
│   │    「とても良い！」    │    │
│   └───────────────────────┘    │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 発話速度                 │   │
│  │ お手本: 45秒            │   │
│  │ あなた: 47秒  (+4.4%)   │   │
│  │ ████████░░  90点        │   │
│  │ 💡 ほぼお手本通りのペース │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 音量パターン類似度       │   │
│  │ ██████████  95点        │   │
│  │ 💡 抑揚のパターンが近い  │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 波形パターン類似度       │   │
│  │ お手本: ▁▂▃▅▆▅▃▂▁▂▃▅   │   │
│  │ あなた: ▁▂▄▅▅▄▂▁▁▂▄▅   │   │
│  │ ██████░░░░  70点        │   │
│  │ 💡 波形の形状が似ている  │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌────────────────────────┐    │
│  │   🎙️ もう一度練習する   │    │
│  └────────────────────────┘    │
│                                 │
└─────────────────────────────────┘
```

**簡易フィードバックスコアの仕組み:**

| 指標 | 計算方法 | 重み |
|------|---------|------|
| 発話速度 | お手本と録音の長さの差分を計算 | 40% |
| 音量パターン類似度 | 時間軸で音量の推移を比較（相関係数） | 30% |
| 波形パターン類似度 | 波形データを正規化して比較 | 30% |

**技術的実装:**
- `record` パッケージで録音
- `just_audio` でお手本の音声長を取得
- `audio_waveforms` パッケージで波形データを抽出・比較
- 波形データを正規化し、相関係数で類似度を算出
- ピッチカーブ比較は実装難易度が高いため将来的な検討事項とする

---

## オリジナル文章機能（プレミアム限定）

自分だけの韓国語文章を登録し、シャドーイング練習ができる機能。
Google Cloud TTSでネイティブ音声を生成し、ローカルに保存。

### オリジナル文章一覧画面

```
┌─────────────────────────────────┐
│  ← オリジナル文章        ＋     │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✓ 推しのインタビュー     │   │
│  │   오늘 정말 행복해요...   │   │
│  │   ⏱️ 0:32               │   │
│  │                    ⋮    │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✓ ドラマのセリフ         │   │
│  │   사랑해, 영원히...       │   │
│  │   ⏱️ 0:45               │   │
│  │                    ⋮    │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │   好きな歌の歌詞         │   │
│  │   널 만난 건 행운이야...   │   │
│  │   ⏱️ 1:05               │   │
│  │                    ⋮    │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐   │
│  │                         │   │
│  │    ＋ 新しい文章を追加    │   │
│  │                         │   │
│  └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘   │
│                                 │
└─────────────────────────────────┘
```

### オリジナル文章作成画面

```
┌─────────────────────────────────┐
│  ← 新規作成            保存     │
├─────────────────────────────────┤
│                                 │
│  タイトル                       │
│  ┌─────────────────────────┐   │
│  │ 推しのインタビュー       │   │
│  └─────────────────────────┘   │
│                                 │
│  韓国語テキスト                 │
│  ┌─────────────────────────┐   │
│  │ 오늘 정말 행복해요.      │   │
│  │ 팬 여러분 덕분에 여기까지 │   │
│  │ 올 수 있었어요. 앞으로도  │   │
│  │ 열심히 하는 모습 보여     │   │
│  │ 드릴게요. 사랑해요!      │   │
│  │                         │   │
│  │                         │   │
│  └─────────────────────────┘   │
│                                 │
│  💡 500文字まで入力できます      │
│                                 │
│  ┌────────────────────────┐    │
│  │   🔊 音声を生成して保存   │    │
│  └────────────────────────┘    │
│                                 │
│  ⚠️ 音声生成には数秒かかります   │
│                                 │
└─────────────────────────────────┘
```

### オリジナル文章編集・削除

```
┌─────────────────────────────────┐
│  オプション                     │
├─────────────────────────────────┤
│                                 │
│  ┌─────────────────────────┐   │
│  │ ✏️ 編集                  │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 🔄 音声を再生成          │   │
│  └─────────────────────────┘   │
│                                 │
│  ┌─────────────────────────┐   │
│  │ 🗑️ 削除                  │   │
│  └─────────────────────────┘   │
│                                 │
└─────────────────────────────────┘
```

### オリジナル文章の仕様

| 項目 | 内容 |
|------|------|
| 対象ユーザー | プレミアム会員限定 |
| 最大文字数 | 500文字 |
| 登録上限 | 無制限（端末容量依存） |
| 音声生成 | Google Cloud TTS（登録・編集時に生成） |
| 保存場所 | ローカル（端末内） |
| データ同期 | なし（端末ごとに独立） |

### オリジナル文章の操作フロー

1. **新規作成**
   - 「＋」ボタンをタップ
   - タイトル・韓国語テキストを入力
   - 「音声を生成して保存」をタップ
   - Google Cloud TTSでMP3生成（ローディング表示）
   - 完了後、一覧に追加

2. **編集**
   - コンテンツカードの「⋮」をタップ
   - 「編集」を選択
   - テキストを修正
   - 「音声を再生成して保存」をタップ

3. **削除**
   - コンテンツカードの「⋮」をタップ
   - 「削除」を選択
   - 確認ダイアログで「削除」
   - コンテンツと音声ファイルを削除

4. **音声再生成**
   - テキストを変更せずに音声だけ再生成したい場合
   - 「音声を再生成」を選択

---

## 技術仕様

### 使用する主要パッケージ

```yaml
dependencies:
  # 音声再生
  just_audio: ^0.9.x
  audio_session: ^0.1.x

  # 録音
  record: ^5.x.x

  # 波形表示（プレミアム機能）
  audio_waveforms: ^1.x.x     # 録音済み音声の波形表示・比較
```

### audio_waveforms パッケージの活用（プレミアム限定）

`audio_waveforms` は録音済み音声ファイルから波形を生成・表示するパッケージです。

**活用できる機能:**
- **波形の抽出**: MP3/WAVファイルから波形データを抽出
- **波形の可視化**: お手本と録音の波形を並べて表示
- **波形データの比較**: 抽出した波形データを数値で比較しスコア化

**波形比較によるスコア算出:**
```dart
// 波形データの類似度を計算
double calculateWaveformSimilarity(
  List<double> referenceWaveform,
  List<double> userWaveform,
) {
  // 正規化後、相関係数で比較
  // ...
}
```

### 音声データ

**Google Cloud Text-to-Speech**で事前に生成し、MP3ファイルとしてアプリ内にバンドル。

```
assets/
├── audio/
│   └── shadowing/
│       ├── beginner/           # 初級（20ファイル）
│       │   ├── 001.mp3
│       │   ├── 002.mp3
│       │   └── ... (020.mp3まで)
│       ├── intermediate/       # 中級（30ファイル）
│       │   ├── 001.mp3
│       │   └── ... (030.mp3まで)
│       └── advanced/           # 高級（40ファイル）
│           ├── 001.mp3
│           └── ... (040.mp3まで)
└── data/
    └── shadowing/
        ├── beginner.json       # 初級コンテンツデータ
        ├── intermediate.json   # 中級コンテンツデータ
        └── advanced.json       # 高級コンテンツデータ
```

### 音声ファイル仕様

- フォーマット: MP3
- サンプリングレート: 44.1kHz
- ビットレート: 128kbps
- 保存場所: アプリ内assets
- 長さ目安: 30秒〜2分程度

### ディレクトリ構成

```
lib/features/shadowing/
├── data/
│   ├── models/
│   │   ├── shadowing_content.dart      # コンテンツモデル
│   │   ├── shadowing_progress.dart     # 進捗モデル
│   │   └── original_content.dart       # オリジナル文章モデル
│   ├── repositories/
│   │   ├── shadowing_repository.dart   # データ取得
│   │   └── original_content_repository.dart # オリジナル文章CRUD
│   └── services/
│       ├── audio_player_service.dart   # 音声再生
│       ├── recorder_service.dart       # 録音
│       └── tts_generator_service.dart  # TTS音声生成
├── domain/
│   └── providers/
│       ├── shadowing_providers.dart    # 基本プロバイダー
│       ├── shadowing_session_provider.dart # セッション管理
│       └── original_content_providers.dart # オリジナル文章管理
└── presentation/
    ├── screens/
    │   ├── shadowing_home_screen.dart     # ホーム（レベル選択）
    │   ├── shadowing_list_screen.dart     # コンテンツ一覧
    │   ├── shadowing_practice_screen.dart # 練習
    │   ├── shadowing_compare_screen.dart  # 比較
    │   ├── original_list_screen.dart      # オリジナル文章一覧
    │   └── original_form_screen.dart      # オリジナル文章作成・編集
    └── widgets/
        ├── audio_player_controls.dart  # 再生コントロール
        └── waveform_visualizer.dart    # 波形表示
```

### データモデル

```dart
/// 音読・シャドーイングコンテンツ
@freezed
class ShadowingContent with _$ShadowingContent {
  const factory ShadowingContent({
    required String id,
    required String title,          // タイトル（例：「自己紹介をしよう」）
    required String text,           // 韓国語テキスト（長文）
    required String meaning,        // 日本語訳
    required String audioPath,      // 音声ファイルパス（assets内）
    required int durationSeconds,   // 音声の長さ（秒）
    String? tip,                    // 発音ポイント
    required ShadowingLevel level,
    required List<TextSegment> segments, // セグメント情報（文/句単位）
  }) = _ShadowingContent;

  factory ShadowingContent.fromJson(Map<String, dynamic> json) =>
      _$ShadowingContentFromJson(json);
}

/// テキストセグメント（文/句単位）
@freezed
class TextSegment with _$TextSegment {
  const factory TextSegment({
    required int index,             // セグメントのインデックス
    required String text,           // セグメントのテキスト（韓国語）
    required String meaning,        // セグメントの日本語訳
    required double startTime,      // 開始時間（秒）
    required double endTime,        // 終了時間（秒）
  }) = _TextSegment;

  factory TextSegment.fromJson(Map<String, dynamic> json) =>
      _$TextSegmentFromJson(json);
}

/// レベル
enum ShadowingLevel {
  beginner,     // 初級 (TOPIK 1-2) - 20コンテンツ
  intermediate, // 中級 (TOPIK 3-4) - 30コンテンツ
  advanced,     // 高級 (TOPIK 5-6) - 40コンテンツ
}

/// 学習進捗
@freezed
class ShadowingProgress with _$ShadowingProgress {
  const factory ShadowingProgress({
    required String contentId,
    required int practiceCount,     // 練習回数
    required bool isMastered,       // マスター済みか（20回以上練習）
    required DateTime lastPracticed,
  }) = _ShadowingProgress;

  factory ShadowingProgress.fromJson(Map<String, dynamic> json) =>
      _$ShadowingProgressFromJson(json);
}

/// レベル別統計
@freezed
class ShadowingLevelStats with _$ShadowingLevelStats {
  const factory ShadowingLevelStats({
    required ShadowingLevel level,
    required int totalCount,        // 全コンテンツ数
    required int masteredCount,     // マスター済み数
    required int practicedCount,    // 1回以上練習した数
  }) = _ShadowingLevelStats;
}

/// オリジナル文章コンテンツ（ローカル保存）
@freezed
class OriginalContent with _$OriginalContent {
  const factory OriginalContent({
    required String id,             // UUID
    required String title,          // タイトル
    required String text,           // 韓国語テキスト
    required String audioPath,      // ローカル音声ファイルパス
    required int durationSeconds,   // 音声の長さ（秒）
    required int practiceCount,     // 練習回数
    required bool isMastered,       // マスター済みか
    required DateTime createdAt,    // 作成日時
    required DateTime updatedAt,    // 更新日時
    DateTime? lastPracticed,        // 最終練習日時
  }) = _OriginalContent;

  factory OriginalContent.fromJson(Map<String, dynamic> json) =>
      _$OriginalContentFromJson(json);
}
```

### オリジナル文章ローカル保存

```
// アプリのドキュメントディレクトリ
{app_documents}/
└── shadowing/
    └── original/
        ├── contents.json           # オリジナル文章データ一覧
        └── audio/
            ├── {uuid_1}.mp3        # 生成された音声ファイル
            ├── {uuid_2}.mp3
            └── ...
```

**contents.json フォーマット**
```json
{
  "version": "1.0.0",
  "contents": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "推しのインタビュー",
      "text": "오늘 정말 행복해요. 팬 여러분 덕분에 여기까지 올 수 있었어요. 앞으로도 열심히 하는 모습 보여 드릴게요. 사랑해요!",
      "audioPath": "shadowing/original/audio/550e8400-e29b-41d4-a716-446655440000.mp3",
      "durationSeconds": 32,
      "practiceCount": 3,
      "isMastered": false,
      "createdAt": "2025-01-15T10:30:00Z",
      "updatedAt": "2025-01-15T10:30:00Z",
      "lastPracticed": "2025-01-16T09:00:00Z"
    }
  ]
}
```

### コンテンツJSONフォーマット

**beginner.json（初級）**
```json
{
  "version": "1.0.0",
  "level": "beginner",
  "contents": [
    {
      "id": "beginner_001",
      "title": "自己紹介をしよう",
      "text": "저는 일본에서 온 사토입니다. 지금 서울에서 한국어를 공부하고 있습니다. 취미는 음악 듣기와 여행입니다. 한국 음식도 정말 좋아합니다. 특히 비빔밥과 김치찌개를 자주 먹습니다. 앞으로 열심히 공부해서 한국어를 잘하고 싶습니다.",
      "meaning": "私は日本から来たサトウです。今ソウルで韓国語を勉強しています。趣味は音楽を聴くことと旅行です。韓国料理も本当に好きです。特にビビンバとキムチチゲをよく食べます。これから一生懸命勉強して韓国語が上手になりたいです。",
      "audioPath": "assets/audio/shadowing/beginner/001.mp3",
      "durationSeconds": 45,
      "tip": "「습니다」は「スムニダ」のように「ㅂ」が「ム」に近くなります",
      "segments": [
        {
          "index": 0,
          "text": "저는 일본에서 온 사토입니다.",
          "meaning": "私は日本から来たサトウです。",
          "startTime": 0.0,
          "endTime": 5.2
        },
        {
          "index": 1,
          "text": "지금 서울에서 한국어를 공부하고 있습니다.",
          "meaning": "今ソウルで韓国語を勉強しています。",
          "startTime": 5.2,
          "endTime": 11.0
        },
        {
          "index": 2,
          "text": "취미는 음악 듣기와 여행입니다.",
          "meaning": "趣味は音楽を聴くことと旅行です。",
          "startTime": 11.0,
          "endTime": 16.5
        },
        {
          "index": 3,
          "text": "한국 음식도 정말 좋아합니다.",
          "meaning": "韓国料理も本当に好きです。",
          "startTime": 16.5,
          "endTime": 21.2
        },
        {
          "index": 4,
          "text": "특히 비빔밥과 김치찌개를 자주 먹습니다.",
          "meaning": "特にビビンバとキムチチゲをよく食べます。",
          "startTime": 21.2,
          "endTime": 28.0
        },
        {
          "index": 5,
          "text": "앞으로 열심히 공부해서 한국어를 잘하고 싶습니다.",
          "meaning": "これから一生懸命勉強して韓国語が上手になりたいです。",
          "startTime": 28.0,
          "endTime": 45.0
        }
      ]
    },
    {
      "id": "beginner_002",
      "title": "私の家族",
      "text": "우리 가족은 네 명입니다. 아버지, 어머니, 언니, 그리고 저입니다. 아버지는 회사원이시고 어머니는 주부세요. 언니는 대학생입니다. 우리 가족은 주말에 같이 영화를 보거나 외식을 합니다. 저는 우리 가족을 정말 사랑합니다.",
      "meaning": "私の家族は4人です。父、母、姉、そして私です。父は会社員で母は主婦です。姉は大学生です。私たちの家族は週末に一緒に映画を見たり外食をしたりします。私は私の家族を本当に愛しています。",
      "audioPath": "assets/audio/shadowing/beginner/002.mp3",
      "durationSeconds": 52,
      "tip": "「세요」は敬語の語尾で「セヨ」と発音します"
    },
    {
      "id": "beginner_003",
      "title": "今日の1日",
      "text": "오늘 아침에 일어나서 먼저 세수를 했습니다. 그리고 아침밥을 먹고 학교에 갔습니다. 학교에서 한국어 수업을 들었습니다. 점심에는 친구와 같이 학교 식당에서 밥을 먹었습니다. 오후에는 도서관에서 공부했습니다. 저녁에 집에 와서 텔레비전을 봤습니다.",
      "meaning": "今日朝起きてまず顔を洗いました。そして朝ごはんを食べて学校に行きました。学校で韓国語の授業を受けました。昼には友達と一緒に学校の食堂でご飯を食べました。午後には図書館で勉強しました。夕方家に帰ってテレビを見ました。",
      "audioPath": "assets/audio/shadowing/beginner/003.mp3",
      "durationSeconds": 65,
      "tip": "過去形の「았/었습니다」に注意して発音しましょう"
    }
  ]
}
```

**intermediate.json（中級）**
```json
{
  "version": "1.0.0",
  "level": "intermediate",
  "contents": [
    {
      "id": "intermediate_001",
      "title": "韓国の四季",
      "text": "한국은 사계절이 뚜렷한 나라입니다. 봄에는 벚꽃이 피고 날씨가 따뜻해집니다. 많은 사람들이 꽃구경을 가죠. 여름은 덥고 습해서 에어컨 없이는 생활하기 어렵습니다. 가을에는 단풍이 아름답고 하늘이 높고 맑습니다. 겨울은 춥지만 눈이 오면 정말 예쁩니다. 저는 특히 가을을 좋아하는데, 날씨도 좋고 맛있는 음식도 많기 때문입니다.",
      "meaning": "韓国は四季がはっきりした国です。春には桜が咲いて天気が暖かくなります。多くの人がお花見に行きますね。夏は暑くて湿気が多いのでエアコンなしでは生活するのが難しいです。秋には紅葉が美しく空が高く澄んでいます。冬は寒いですが雪が降ると本当にきれいです。私は特に秋が好きですが、天気も良くておいしい食べ物も多いからです。",
      "audioPath": "assets/audio/shadowing/intermediate/001.mp3",
      "durationSeconds": 78,
      "tip": "「뚜렷한」は濃音で「ットゥリョッタン」と発音します"
    }
  ]
}
```

**advanced.json（高級）**
```json
{
  "version": "1.0.0",
  "level": "advanced",
  "contents": [
    {
      "id": "advanced_001",
      "title": "環境問題についての意見",
      "text": "최근 환경 문제가 전 세계적으로 심각해지고 있습니다. 지구 온난화로 인해 이상 기후 현상이 빈번하게 발생하고 있으며, 해수면 상승으로 일부 지역은 침수 위험에 처해 있습니다. 이러한 문제를 해결하기 위해서는 개인적인 노력뿐만 아니라 정부와 기업의 적극적인 참여가 필요합니다. 우리 모두가 환경 보호에 대한 인식을 높이고, 일회용품 사용을 줄이며, 재활용을 생활화해야 합니다. 미래 세대를 위해 지금 당장 행동에 나서야 할 때입니다.",
      "meaning": "最近、環境問題が世界的に深刻化しています。地球温暖化により異常気象現象が頻繁に発生しており、海面上昇により一部の地域は浸水の危険にさらされています。このような問題を解決するためには、個人的な努力だけでなく、政府と企業の積極的な参加が必要です。私たち全員が環境保護に対する意識を高め、使い捨て製品の使用を減らし、リサイクルを生活化しなければなりません。未来の世代のために今すぐ行動に移すべき時です。",
      "audioPath": "assets/audio/shadowing/advanced/001.mp3",
      "durationSeconds": 95,
      "tip": "「전 세계적으로」は「チョン セゲジョグロ」と発音し、長い複合語に注意"
    }
  ]
}
```

### API設計（バックエンド）

```
GET /api/shadowing/progress
  - レスポンス: ユーザーの全進捗一覧

POST /api/shadowing/progress
  - リクエスト: { contentId, practiceCount }
  - レスポンス: 更新された進捗

GET /api/shadowing/stats/summary
  - レスポンス: レベル別統計サマリー
```

※ コンテンツ自体はアプリ内のJSONファイルから読み込み、進捗のみバックエンドで管理。

---

## 進捗管理

### マスター条件

| 基準 | 条件 |
|------|------|
| 練習回数 | 20回以上 |

### 学習記録

- 練習した日時を記録
- アプリ全体の連続学習日数に反映（他機能と同様）
- 総マスター数を統計として表示

---

## 実装フェーズ

### Phase 1: 基本機能（MVP）
- [ ] コンテンツJSON作成（各レベル3〜5コンテンツずつ）
- [ ] 音声ファイル生成（Google Cloud TTS）
- [ ] コンテンツ表示（タイトル＋本文＋日本語訳）
- [ ] 音声再生（アプリ内MP3）
- [ ] 再生速度調整
- [ ] 基本的な進捗保存

### Phase 2: セグメント再生 + 自動ハイライト機能
- [ ] セグメント情報をJSONに追加（文/句単位の開始・終了時間）
- [ ] 再生位置に応じたテキストハイライト表示
- [ ] 自動スクロール追従
- [ ] セグメントタップでその文だけ再生
- [ ] セグメント長押しでリピート設定

### Phase 3: 録音機能
- [ ] 録音・再生機能
- [ ] お手本との波形比較表示

### Phase 4: 簡易フィードバックスコア機能（プレミアム）
- [ ] 発話速度スコア（お手本と録音の長さ比較）
- [ ] 音量パターン類似度スコア（相関係数計算）
- [ ] 波形パターン類似度スコア
- [ ] 総合スコア表示画面

### Phase 5: UI/UX改善
- [ ] テキスト表示ON/OFF
- [ ] 区間リピート（A-Bリピート）
- [ ] スワイプ操作

### Phase 6: コンテンツ拡充
- [ ] 初級コンテンツ20個作成（セグメント情報含む）
- [ ] 中級コンテンツ30個作成（セグメント情報含む）
- [ ] 高級コンテンツ40個作成（セグメント情報含む）

### Phase 7: オリジナル文章機能
- [ ] オリジナル文章のデータモデル・ローカル保存
- [ ] オリジナル文章一覧画面
- [ ] オリジナル文章作成・編集画面
- [ ] Google Cloud TTS連携（音声生成）
- [ ] 削除機能（音声ファイル含む）
- [ ] オリジナル文章での練習画面

---

## 課金モデル

| 機能 | 無料 | プレミアム |
|------|------|----------|
| 初級コンテンツ | ○ | ○ |
| 中級コンテンツ | ✕ | ○ |
| 高級コンテンツ | ✕ | ○ |
| セグメント再生 + ハイライト | ○ | ○ |
| 録音・比較機能 | ✕ | ○ |
| 簡易フィードバックスコア | ✕ | ○ |
| オリジナル文章機能 | ✕ | ○ |

---

## home_screen.dart への追加

機能グリッドに以下を追加：

```dart
_FeatureItem(
  title: '音読',
  icon: Iconsax.voice_square,
  gradientColors: FeatureGradients.shadowing, // 新規追加
  onTap: _openShadowing,
),
```

グラデーションカラー案：
```dart
static const shadowing = [Color(0xFF6366F1), Color(0xFF8B5CF6)]; // 紫系
```

---

## コンテンツ数まとめ

| レベル | コンテンツ数 | 音声長さ目安 |
|--------|------------|------------|
| 初級（TOPIK 1-2） | 20 | 30秒〜1分 |
| 中級（TOPIK 3-4） | 30 | 1分〜1分30秒 |
| 高級（TOPIK 5-6） | 40 | 1分〜2分 |
| **合計** | **90** | - |

---

## 参考：シャドーイングの学習効果

1. **リスニング力向上**: 音声を聞きながら発声することで、音声認識能力が向上
2. **発音改善**: ネイティブの発音を真似することで、正しいイントネーション・アクセントを習得
3. **スピーキング力向上**: 反復練習により、スムーズに言葉が出てくるようになる
4. **語彙の定着**: 声に出すことで記憶への定着率が向上
5. **文法感覚の習得**: 文の構造を体感的に覚える

---

## 今後の検討事項

1. **オフライン完全対応**: 進捗のローカル保存とサーバー同期
2. **単語帳連携**: 単語帳の単語をシャドーイング練習に追加
3. **オリジナル文章のクラウド同期**: 端末間でオリジナル文章を共有
4. **オリジナル文章のインポート/エクスポート**: バックアップ機能
5. **ピッチカーブ比較機能**: 声の高低（ピッチ）の推移を比較してスコア化
   - 専門的な信号処理ライブラリが必要
   - `pitch_detector_dart` や `flutter_pitch` パッケージを使用
   - 実装難易度が高いため、Phase 4の簡易スコアで十分な効果が得られるか検証後に判断
