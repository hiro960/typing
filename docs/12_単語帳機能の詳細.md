# å˜èªå¸³æ©Ÿèƒ½ã®è©³ç´°ä»•æ§˜

## ç›®æ¬¡
1. [æ©Ÿèƒ½æ¦‚è¦ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼](#1-æ©Ÿèƒ½æ¦‚è¦ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼)
2. [ãƒ‡ãƒ¼ã‚¿æ§‹é€ ](#2-ãƒ‡ãƒ¼ã‚¿æ§‹é€ )
3. [å˜èªå¸³ç”»é¢ï¼ˆä¸€è¦§è¡¨ç¤ºï¼‰](#3-å˜èªå¸³ç”»é¢ä¸€è¦§è¡¨ç¤º)
4. [å˜èªè¿½åŠ ãƒ»ç·¨é›†ç”»é¢](#4-å˜èªè¿½åŠ ç·¨é›†ç”»é¢)
   - 4.4 [å˜èªè©³ç´°ç”»é¢](#44-å˜èªè©³ç´°ç”»é¢)
5. [æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½](#5-æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½)
6. [éŸ³å£°å†ç”Ÿæ©Ÿèƒ½](#6-éŸ³å£°å†ç”Ÿæ©Ÿèƒ½)
   - 6.4 [éŸ³å£°è¨­å®š](#64-éŸ³å£°è¨­å®š)
7. [çŠ¶æ…‹ç®¡ç†ï¼ˆRiverpodè¨­è¨ˆï¼‰](#7-çŠ¶æ…‹ç®¡ç†riverpodè¨­è¨ˆ)
8. [APIä»•æ§˜](#8-apiä»•æ§˜)
9. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#9-ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
   - 9.5 [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªç·¨é›†ãƒ•ãƒ­ãƒ¼](#95-ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªç·¨é›†ãƒ•ãƒ­ãƒ¼)
   - 9.6 [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªå‰Šé™¤ãƒ•ãƒ­ãƒ¼](#96-ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªå‰Šé™¤ãƒ•ãƒ­ãƒ¼)
10. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#10-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
11. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#11-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
12. [ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§](#12-ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§)

---

## 1. æ©Ÿèƒ½æ¦‚è¦ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼

### 1.1 å…¨ä½“ãƒ•ãƒ­ãƒ¼
```
å˜èªå¸³ç”»é¢ï¼ˆä¸€è¦§ï¼‰
    â†“ ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠï¼ˆãƒã‚¤å˜èª/ä¾‹æ–‡/ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰
    â†“ æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
    â†“
ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ2åˆ—ï¼‰
    â†“ å˜èªã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—
    â†“
å˜èªè©³ç´°ç”»é¢
    â†“ ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    â†“
ç·¨é›†ç”»é¢
    â†“ ä¿å­˜
    â†“
ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡ï¼ˆPOST/PUT /api/wordbookï¼‰
    â†“
ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰
```

### 1.2 å„ç”»é¢ã®å½¹å‰²

| ç”»é¢ | å½¹å‰² | ä¸»è¦æ©Ÿèƒ½ |
|------|------|----------|
| å˜èªå¸³ä¸€è¦§ | ç™»éŒ²ã—ãŸå˜èªã®é–²è¦§ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° | ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ‡ã‚Šæ›¿ãˆã€æ¤œç´¢ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º |
| å˜èªè©³ç´° | å˜èªã®è©³ç´°æƒ…å ±è¡¨ç¤º | å˜èªãƒ»æ„å‘³ãƒ»ä¾‹æ–‡è¡¨ç¤ºã€éŸ³å£°å†ç”Ÿã€ç·¨é›†/å‰Šé™¤ |
| å˜èªè¿½åŠ  | æ–°ã—ã„å˜èªã®ç™»éŒ² | å˜èªå…¥åŠ›ã€æ„å‘³å…¥åŠ›ã€ä¾‹æ–‡å…¥åŠ›ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é¸æŠ |
| å˜èªç·¨é›† | ç™»éŒ²æ¸ˆã¿å˜èªã®ç·¨é›† | å†…å®¹å¤‰æ›´ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã€å‰Šé™¤ |

### 1.3 ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

**âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆUIå±¤ã®ã¿ï¼‰**
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ‡ã‚Šæ›¿ãˆï¼ˆãƒã‚¤å˜èª/ä¾‹æ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³/ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰
- æ¤œç´¢UIï¼ˆå˜èªãƒ»æ„å‘³ãƒ»ä¾‹æ–‡ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆè¦šãˆãŸ/å¾©ç¿’ä¸­/è¦ç¢ºèªï¼‰
- ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆ2åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- å˜èªã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³

**âŒ æœªå®Ÿè£…**
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å±¤ï¼ˆFreezed/JSON Serializableï¼‰
- ãƒªãƒã‚¸ãƒˆãƒªå±¤ï¼ˆAPIé€šä¿¡ï¼‰
- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å±¤ï¼ˆRiverpodçŠ¶æ…‹ç®¡ç†ï¼‰
- å˜èªè¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½
- éŸ³å£°å†ç”Ÿæ©Ÿèƒ½
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«

---

## 2. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 2.1 ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ–¹æ³•

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼åŒæœŸå‹**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²ã—ãŸå˜èªã¯PostgreSQLã«ä¿å­˜
- ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- CRUDæ“ä½œã¯ã‚µãƒ¼ãƒãƒ¼APIã‚’é€šã˜ã¦å®Ÿè¡Œ
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¸€æ™‚ä¿å­˜ã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«åŒæœŸ

### 2.2 Prismaã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```prisma
model Wordbook {
  id              String       @id @default(cuid())
  userId          String
  word            String       // éŸ“å›½èªå˜èª
  meaning         String       // æ—¥æœ¬èªè¨³
  example         String?      // ä¾‹æ–‡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  status          WordStatus   @default(REVIEWING)
  category        WordCategory @default(MY_WORDS)
  lastReviewedAt  DateTime?    // æœ€çµ‚å¾©ç¿’æ—¥æ™‚
  reviewCount     Int          @default(0)  // å¾©ç¿’å›æ•°
  successRate     Float        @default(0)  // æ­£è§£ç‡ï¼ˆ0.0 ~ 1.0ï¼‰
  tags            String[]     @default([]) // ã‚¿ã‚°é…åˆ—
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([status])
  @@map("wordbooks")
}

enum WordStatus {
  MASTERED       // è¦šãˆãŸ
  REVIEWING      // å¾©ç¿’ä¸­
  NEEDS_REVIEW   // è¦ç¢ºèª
}

enum WordCategory {
  MY_WORDS       // ãƒã‚¤å˜èª
  EXAMPLES       // ä¾‹æ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
  IDIOMS         // ãƒ•ãƒ¬ãƒ¼ã‚º/æ…£ç”¨å¥
}
```

### 2.3 Flutterãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆFreezedï¼‰

```dart
@freezed
class Word with _$Word {
  const factory Word({
    required String id,
    required String userId,
    required String word,
    required String meaning,
    String? example,
    required WordStatus status,
    required WordCategory category,
    DateTime? lastReviewedAt,
    @Default(0) int reviewCount,
    @Default(0.0) double successRate,
    @Default([]) List<String> tags,
    DateTime? createdAt,
    DateTime? updatedAt,
  }) = _Word;

  factory Word.fromJson(Map<String, dynamic> json) => _$WordFromJson(json);
}

enum WordStatus {
  MASTERED,      // è¦šãˆãŸ
  REVIEWING,     // å¾©ç¿’ä¸­
  NEEDS_REVIEW   // è¦ç¢ºèª
}

enum WordCategory {
  MY_WORDS,      // ãƒã‚¤å˜èª
  EXAMPLES,      // ä¾‹æ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
  IDIOMS         // ãƒ•ãƒ¬ãƒ¼ã‚º/æ…£ç”¨å¥
}

// JSONå¤‰æ›ç”¨ã®æ‹¡å¼µ
extension WordStatusExtension on WordStatus {
  String toJson() => name;

  static WordStatus fromJson(String json) {
    return WordStatus.values.firstWhere((e) => e.name == json);
  }
}

extension WordCategoryExtension on WordCategory {
  String toJson() => name;

  static WordCategory fromJson(String json) {
    return WordCategory.values.firstWhere((e) => e.name == json);
  }
}
```

### 2.4 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `id` | String | å˜èªã®ä¸€æ„ãªè­˜åˆ¥å­ï¼ˆcuidï¼‰ |
| `userId` | String | ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID |
| `word` | String | éŸ“å›½èªå˜èªï¼ˆå¿…é ˆï¼‰ |
| `meaning` | String | æ—¥æœ¬èªè¨³ï¼ˆå¿…é ˆï¼‰ |
| `example` | String? | ä¾‹æ–‡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `status` | Enum | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆè¦šãˆãŸ/å¾©ç¿’ä¸­/è¦ç¢ºèªï¼‰ |
| `category` | Enum | ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆãƒã‚¤å˜èª/ä¾‹æ–‡/ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰ |
| `lastReviewedAt` | DateTime? | æœ€çµ‚å¾©ç¿’æ—¥æ™‚ï¼ˆå¾©ç¿’æ©Ÿèƒ½ã§è‡ªå‹•æ›´æ–°ã€æ‰‹å‹•ç·¨é›†ä¸å¯ï¼‰ |
| `reviewCount` | Int | å¾©ç¿’å›æ•°ï¼ˆå¾©ç¿’æ©Ÿèƒ½ã§è‡ªå‹•æ›´æ–°ã€æ‰‹å‹•ç·¨é›†ä¸å¯ï¼‰ |
| `successRate` | Float | æ­£è§£ç‡ 0.0 ~ 1.0ï¼ˆå¾©ç¿’æ©Ÿèƒ½ã§è‡ªå‹•æ›´æ–°ã€æ‰‹å‹•ç·¨é›†ä¸å¯ï¼‰ |
| `tags` | String[] | ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°é…åˆ— |
| `createdAt` | DateTime | ä½œæˆæ—¥æ™‚ |
| `updatedAt` | DateTime | æ›´æ–°æ—¥æ™‚ |

**æ³¨æ„**: `lastReviewedAt`ã€`reviewCount`ã€`successRate` ã¯ã€ä»Šå¾Œå®Ÿè£…äºˆå®šã®ã€Œå¾©ç¿’æ©Ÿèƒ½ã€ã§è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå˜èªè¿½åŠ ãƒ»ç·¨é›†ç”»é¢ã§ç›´æ¥ç·¨é›†ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## 3. å˜èªå¸³ç”»é¢ï¼ˆä¸€è¦§è¡¨ç¤ºï¼‰

### 3.1 ç”»é¢æ§‹æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“– å˜èªå¸³            [æ–°è¦è¿½åŠ ]  â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ãƒã‚¤å˜èª] [ä¾‹æ–‡] [ãƒ•ãƒ¬ãƒ¼ã‚º]    â”‚  â† ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” å˜èªãƒ»æ„å‘³ãƒ»ä¾‹æ–‡ã§æ¤œç´¢       â”‚  â† æ¤œç´¢ãƒãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è¦šãˆãŸ] [å¾©ç¿’ä¸­] [è¦ç¢ºèª]      â”‚  â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš” â”‚  â”‚  ì„¤ë ˆë‹¤  â”‚      â”‚  â† å˜èªã‚«ãƒ¼ãƒ‰ï¼ˆ2åˆ—ï¼‰
â”‚  â”‚ ã“ã‚“ã«ã¡ã¯â”‚  â”‚ ã¨ãã‚ã â”‚      â”‚
â”‚  â”‚ è¦šãˆãŸ   â”‚  â”‚ å¾©ç¿’ä¸­   â”‚      â”‚
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš”?â”‚  â”‚ ë‚´ì¼ í•œêµ­â”‚      â”‚
â”‚  â”‚ ã‚ª..     â”‚  â”‚ ì—¬í–‰ì´ë¼ â”‚      â”‚
â”‚  â”‚      ğŸ”Š  â”‚  â”‚      ğŸ”Š  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ë¹„ê°€ ì˜¤ë‹¤ â”‚  â”‚  í™”ì´íŒ…  â”‚      â”‚
â”‚  â”‚ é›¨ãŒé™ã‚‹ â”‚  â”‚ ãƒ•ã‚¡ã‚¤ãƒˆ â”‚      â”‚
â”‚  â”‚ è¦ç¢ºèª   â”‚  â”‚ è¦šãˆãŸ   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç”»é¢è¦ç´ ã®è©³ç´°

#### ãƒ˜ãƒƒãƒ€ãƒ¼
- ã‚¿ã‚¤ãƒˆãƒ«: ã€ŒğŸ“– å˜èªå¸³ã€
- æ–°è¦è¿½åŠ ãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šï¼‰
  - ã‚¿ãƒƒãƒ—ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚·ãƒ¼ãƒˆã‚’è¡¨ç¤º
  - å˜èªè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º

#### ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–
- `SegmentedButton`ã§å®Ÿè£…
- 3ã¤ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼:
  - ãƒã‚¤å˜èªï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¸æŠï¼‰
  - ä¾‹æ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
  - ãƒ•ãƒ¬ãƒ¼ã‚º/æ…£ç”¨å¥
- ã‚¿ãƒƒãƒ—ã§å³åº§ã«åˆ‡ã‚Šæ›¿ãˆ

#### æ¤œç´¢ãƒãƒ¼
- `TextField`ã§å®Ÿè£…
- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: ã€Œå˜èªãƒ»æ„å‘³ãƒ»ä¾‹æ–‡ã§æ¤œç´¢ã€
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ï¼ˆå…¥åŠ›ã”ã¨ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰
- æ¤œç´¢å¯¾è±¡:
  - å˜èªï¼ˆéŸ“å›½èªï¼‰
  - æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰
  - ä¾‹æ–‡ï¼ˆéŸ“å›½èªãƒ»æ—¥æœ¬èªä¸¡æ–¹ï¼‰

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `FilterChip`ã§å®Ÿè£…
- 3ã¤ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:
  - è¦šãˆãŸï¼ˆMASTEREDï¼‰
  - å¾©ç¿’ä¸­ï¼ˆREVIEWINGï¼‰
  - è¦ç¢ºèªï¼ˆNEEDS_REVIEWï¼‰
- è¤‡æ•°é¸æŠå¯èƒ½
- ä½•ã‚‚é¸æŠã—ãªã„å ´åˆã¯å…¨ä»¶è¡¨ç¤º

#### å˜èªã‚«ãƒ¼ãƒ‰
**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¦šãˆãŸ]             â”‚  â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
â”‚                     â”‚
â”‚ ì•ˆë…•í•˜ì„¸ìš”            â”‚  â† å˜èªï¼ˆ24pxã€Boldï¼‰
â”‚ ã“ã‚“ã«ã¡ã¯           â”‚  â† æ„å‘³ï¼ˆ16pxã€Grayï¼‰
â”‚                     â”‚
â”‚ ì•ˆë…•í•˜ì„¸ìš”? ì˜¤ëŠ˜ë„... â”‚  â† ä¾‹æ–‡ï¼ˆ14pxã€3è¡Œã¾ã§ï¼‰
â”‚                     â”‚
â”‚              ğŸ”Š     â”‚  â† éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚«ãƒ¼ãƒ‰ã®çŠ¶æ…‹**:
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç™½èƒŒæ™¯ï¼ˆãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
- ãƒ›ãƒãƒ¼: è»½ã„å½±ã‚’è¿½åŠ 
- ã‚¿ãƒƒãƒ—: è©³ç´°ç”»é¢ã¸é·ç§»

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ã®è‰²**:
- è¦šãˆãŸ: ç·‘è‰²ï¼ˆ`primary.withOpacity(0.08)`ï¼‰
- å¾©ç¿’ä¸­: é»„è‰²ï¼ˆ`warning.withOpacity(0.08)`ï¼‰
- è¦ç¢ºèª: èµ¤è‰²ï¼ˆ`error.withOpacity(0.08)`ï¼‰

### 3.3 ãƒ‡ãƒ¼ã‚¿å–å¾—

#### åˆå›ãƒ­ãƒ¼ãƒ‰
1. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã« `GET /api/wordbook` ã‚’å‘¼ã³å‡ºã—
2. ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å…¨å˜èªã‚’å–å¾—ï¼ˆæ›´æ–°æ—¥æ™‚ã®é™é †ã§ã‚½ãƒ¼ãƒˆï¼‰
3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ï¼ˆSharedPreferencesï¼‰
4. UIã«è¡¨ç¤º

#### ã‚½ãƒ¼ãƒˆé †
**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ**: æ›´æ–°æ—¥æ™‚ã®é™é †ï¼ˆ`updatedAt DESC`ï¼‰
- æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸå˜èªãŒä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç·¨é›†ã—ãŸå˜èªãŒå¸¸ã«è¦‹ã¤ã‘ã‚„ã™ã„
- ã‚µãƒ¼ãƒãƒ¼å´ã§ `orderBy: { updatedAt: 'desc' }` ã‚’æŒ‡å®š

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³åº§ã«è¡¨ç¤º
- **ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ›´æ–°**: åŒæ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
- **å·®åˆ†ãƒãƒ¼ã‚¸**: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ã¦æ›´æ–°

#### ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»æ¤œç´¢ã®å®Ÿè£…æ–¹é‡

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’æ¡ç”¨**:
- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å…¨å˜èªã‚’å–å¾—ï¼ˆåˆå›ã®ã¿ï¼‰
- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ¤œç´¢ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å®Ÿè¡Œ
- ç†ç”±: å€‹äººãƒ‡ãƒ¼ã‚¿ã§é€šå¸¸æ•°ç™¾ä»¶ç¨‹åº¦ãªã®ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å‡¦ç†å¯èƒ½
- ãƒ¡ãƒªãƒƒãƒˆ: é«˜é€Ÿãªæ¤œç´¢ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã€ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›

**æ¤œç´¢å¯¾è±¡**:
- å˜èªï¼ˆéŸ“å›½èªï¼‰
- æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰
- ä¾‹æ–‡ï¼ˆéŸ“å›½èªãƒ»æ—¥æœ¬èªï¼‰
- ã‚¿ã‚°

```dart
List<Word> getFilteredWords({
  required WordCategory category,
  required Set<WordStatus> statusFilters,
  required String searchQuery,
}) {
  return allWords
    .where((word) => word.category == category)
    .where((word) => statusFilters.isEmpty || statusFilters.contains(word.status))
    .where((word) {
      if (searchQuery.isEmpty) return true;
      final query = searchQuery.toLowerCase();
      return word.word.toLowerCase().contains(query) ||
             word.meaning.toLowerCase().contains(query) ||
             (word.example?.toLowerCase().contains(query) ?? false) ||
             word.tags.any((tag) => tag.toLowerCase().contains(query));
    })
    .toList();
}
```

**å°†æ¥ã®æ‹¡å¼µ**: å˜èªæ•°ãŒæ•°åƒä»¶ã‚’è¶…ãˆã‚‹å ´åˆã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰æ¤œç´¢ã¸ã®ç§»è¡Œã‚’æ¤œè¨ã€‚ãã®å ´åˆã€`GET /api/wordbook?q={searchQuery}` ã®ã‚ˆã†ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã€‚

### 3.4 ç¾åœ¨ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰

**ç¾åœ¨ã®`wordbook_screen.dart`ã®å®Ÿè£…çŠ¶æ³**:
- âœ… ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ‡ã‚Šæ›¿ãˆï¼ˆSegmentedButtonï¼‰
- âœ… æ¤œç´¢ãƒãƒ¼ï¼ˆTextFieldï¼‰
- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆFilterChipï¼‰
- âœ… ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºï¼ˆGridView.builderã€2åˆ—ï¼‰
- âœ… å˜èªã‚«ãƒ¼ãƒ‰UIï¼ˆFCard.rawï¼‰
- âŒ ãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
- âŒ APIé€£æºãªã—
- âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã—

---

## 4. å˜èªè¿½åŠ ãƒ»ç·¨é›†ç”»é¢

### 4.1 å˜èªè¿½åŠ ç”»é¢ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æ–°ã—ã„å˜èªã‚’è¿½åŠ       [ä¿å­˜]  â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  å˜èª *                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš”              â”‚     â”‚  â† TextField
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â”‚  æ„å‘³ *                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ã“ã‚“ã«ã¡ã¯              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â”‚  ä¾‹æ–‡                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš”? ì˜¤ëŠ˜ë„ ì—´ê³µí•´ìš”!â”‚     â”‚  â† TextFieldï¼ˆè¤‡æ•°è¡Œï¼‰
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â”‚  ã‚«ãƒ†ã‚´ãƒªãƒ¼                     â”‚
â”‚  â—‹ ãƒã‚¤å˜èª                    â”‚  â† RadioButton
â”‚  â—‹ ä¾‹æ–‡ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³             â”‚
â”‚  â—‹ ãƒ•ãƒ¬ãƒ¼ã‚º/æ…£ç”¨å¥              â”‚
â”‚                                 â”‚
â”‚  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                     â”‚
â”‚  â—‹ è¦šãˆãŸ                      â”‚
â”‚  â— å¾©ç¿’ä¸­ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰         â”‚
â”‚  â—‹ è¦ç¢ºèª                      â”‚
â”‚                                 â”‚
â”‚  ã‚¿ã‚°                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ #æŒ¨æ‹¶ #åŸºæœ¬è¡¨ç¾          â”‚     â”‚  â† Chipå…¥åŠ›
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â”‚  [ä¿å­˜]                         â”‚  â† ä¿å­˜ãƒœã‚¿ãƒ³
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å¿…é ˆ | èª¬æ˜ | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
|-----------|------|------|----------------|
| å˜èª | âœ“ | éŸ“å›½èªå˜èª | 1æ–‡å­—ä»¥ä¸Šã€100æ–‡å­—ä»¥ä¸‹ |
| æ„å‘³ | âœ“ | æ—¥æœ¬èªè¨³ | 1æ–‡å­—ä»¥ä¸Šã€200æ–‡å­—ä»¥ä¸‹ |
| ä¾‹æ–‡ | - | éŸ“å›½èªä¾‹æ–‡ | 500æ–‡å­—ä»¥ä¸‹ |
| ã‚«ãƒ†ã‚´ãƒªãƒ¼ | âœ“ | ãƒã‚¤å˜èª/ä¾‹æ–‡/ãƒ•ãƒ¬ãƒ¼ã‚º | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒã‚¤å˜èª |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | âœ“ | è¦šãˆãŸ/å¾©ç¿’ä¸­/è¦ç¢ºèª | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å¾©ç¿’ä¸­ |
| ã‚¿ã‚° | - | ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚°ï¼ˆè¤‡æ•°å¯ï¼‰ | å„ã‚¿ã‚°20æ–‡å­—ä»¥ä¸‹ã€æœ€å¤§10å€‹ |

**æ³¨æ„**: å¾©ç¿’é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`lastReviewedAt`ã€`reviewCount`ã€`successRate`ï¼‰ã¯ã€å˜èªè¿½åŠ ãƒ»ç·¨é›†ç”»é¢ã§ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã®å¾©ç¿’æ©Ÿèƒ½ã§è‡ªå‹•çš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

### 4.3 ä¿å­˜ãƒœã‚¿ãƒ³ã®å‹•ä½œ

#### æ–°è¦è¿½åŠ ã®å ´åˆ
1. å…¥åŠ›å†…å®¹ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
2. ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°è¡¨ç¤ºï¼ˆèµ¤è‰²ãƒ†ã‚­ã‚¹ãƒˆï¼‰
3. å•é¡Œãªã‘ã‚Œã° `POST /api/wordbook` ã‚’å‘¼ã³å‡ºã—
4. æˆåŠŸã—ãŸã‚‰å˜èªå¸³ä¸€è¦§ã¸æˆ»ã‚‹
5. å¤±æ•—ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

#### ç·¨é›†ã®å ´åˆ
1. å¤‰æ›´å†…å®¹ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
2. `PUT /api/wordbook/{id}` ã‚’å‘¼ã³å‡ºã—
3. æˆåŠŸã—ãŸã‚‰å˜èªå¸³ä¸€è¦§ã¸æˆ»ã‚‹
4. å¤±æ•—ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

#### ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å‡¦ç†
1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¸€æ™‚ä¿å­˜
2. ã€Œã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä¿å­˜ã—ã¾ã—ãŸã€ã¨ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã§é€šçŸ¥
3. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«è‡ªå‹•é€ä¿¡
4. é€ä¿¡å¤±æ•—ã—ãŸã‚‰å†è©¦è¡Œã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 

### 4.4 å˜èªè©³ç´°ç”»é¢

#### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  ë‹¨ì–´ ìƒì„¸          [ç·¨é›†] [å‰Šé™¤] â”‚  â† ãƒ˜ãƒƒãƒ€ãƒ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ [è¦šãˆãŸ]                â”‚     â”‚  â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš”               â”‚     â”‚  â† å˜èªï¼ˆ32pxã€Boldï¼‰
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ã“ã‚“ã«ã¡ã¯              â”‚     â”‚  â† æ„å‘³ï¼ˆ20pxï¼‰
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ğŸ”Š                     â”‚     â”‚  â† éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚     â”‚  â† åŒºåˆ‡ã‚Šç·š
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ä¾‹æ–‡                    â”‚     â”‚  â† ãƒ©ãƒ™ãƒ«
â”‚  â”‚ ì•ˆë…•í•˜ì„¸ìš”? ì˜¤ëŠ˜ë„ ì—´ê³µí•´ìš”! â”‚     â”‚  â† ä¾‹æ–‡ãƒ†ã‚­ã‚¹ãƒˆ
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚     â”‚  â† åŒºåˆ‡ã‚Šç·š
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ã‚«ãƒ†ã‚´ãƒªãƒ¼              â”‚     â”‚  â† ãƒ©ãƒ™ãƒ«
â”‚  â”‚ ãƒã‚¤å˜èª                â”‚     â”‚
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ã‚¿ã‚°                    â”‚     â”‚  â† ãƒ©ãƒ™ãƒ«
â”‚  â”‚ #æŒ¨æ‹¶ #åŸºæœ¬è¡¨ç¾         â”‚     â”‚  â† ã‚¿ã‚°Chip
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚     â”‚  â† åŒºåˆ‡ã‚Šç·š
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚ ä½œæˆæ—¥: 2024/01/01     â”‚     â”‚  â† ãƒ¡ã‚¿æƒ…å ±
â”‚  â”‚ æ›´æ–°æ—¥: 2024/03/15     â”‚     â”‚
â”‚  â”‚ å¾©ç¿’å›æ•°: 5å›           â”‚     â”‚
â”‚  â”‚ æ­£è§£ç‡: 95%             â”‚     â”‚
â”‚  â”‚                        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨ç¤ºé …ç›®

| é …ç›® | èª¬æ˜ | è¡¨ç¤ºæ¡ä»¶ |
|------|------|----------|
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ | è¦šãˆãŸ/å¾©ç¿’ä¸­/è¦ç¢ºèª | å¸¸ã«è¡¨ç¤º |
| å˜èª | éŸ“å›½èªå˜èª | å¸¸ã«è¡¨ç¤º |
| æ„å‘³ | æ—¥æœ¬èªè¨³ | å¸¸ã«è¡¨ç¤º |
| éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³ | å˜èªã‚’èª­ã¿ä¸Šã’ã‚‹ | å¸¸ã«è¡¨ç¤º |
| ä¾‹æ–‡ | éŸ“å›½èªä¾‹æ–‡ | ä¾‹æ–‡ãŒã‚ã‚‹å ´åˆã®ã¿ |
| ã‚«ãƒ†ã‚´ãƒªãƒ¼ | ãƒã‚¤å˜èª/ä¾‹æ–‡/ãƒ•ãƒ¬ãƒ¼ã‚º | å¸¸ã«è¡¨ç¤º |
| ã‚¿ã‚° | ã‚«ã‚¹ã‚¿ãƒ ã‚¿ã‚° | ã‚¿ã‚°ãŒã‚ã‚‹å ´åˆã®ã¿ |
| ä½œæˆæ—¥ | ç™»éŒ²æ—¥æ™‚ | å¸¸ã«è¡¨ç¤º |
| æ›´æ–°æ—¥ | æœ€çµ‚æ›´æ–°æ—¥æ™‚ | å¸¸ã«è¡¨ç¤º |
| å¾©ç¿’å›æ•° | å¾©ç¿’ã—ãŸå›æ•° | å¾©ç¿’æ©Ÿèƒ½å®Ÿè£…å¾Œã«è¡¨ç¤º |
| æ­£è§£ç‡ | æ­£è§£ç‡ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ | å¾©ç¿’æ©Ÿèƒ½å®Ÿè£…å¾Œã«è¡¨ç¤º |

#### æ“ä½œ

**ç·¨é›†ãƒœã‚¿ãƒ³**:
- ã‚¿ãƒƒãƒ—ã§å˜èªç·¨é›†ç”»é¢ã¸é·ç§»
- ç·¨é›†ç”»é¢ã«ã¯ç¾åœ¨ã®å€¤ãŒå…¥åŠ›æ¸ˆã¿ã§è¡¨ç¤º

**å‰Šé™¤ãƒœã‚¿ãƒ³**:
- ã‚¿ãƒƒãƒ—ã§å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
- ç¢ºèªå¾Œã€`DELETE /api/wordbook/{id}` ã‚’å®Ÿè¡Œ
- æˆåŠŸã—ãŸã‚‰ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ï¼ˆè©³ç´°ã¯ã€Œ9.6 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªå‰Šé™¤ãƒ•ãƒ­ãƒ¼ã€å‚ç…§ï¼‰

**éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³ï¼ˆğŸ”Šï¼‰**:
- ã‚¿ãƒƒãƒ—ã§å˜èªã‚’éŸ“å›½èªéŸ³å£°ã§èª­ã¿ä¸Šã’
- `WordAudioService.speak()` ã‚’ä½¿ç”¨

**æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆâ†ï¼‰**:
- ã‚¿ãƒƒãƒ—ã§ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹

#### ç”»é¢é·ç§»

```
å˜èªå¸³ä¸€è¦§
    â†“ å˜èªã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ—
å˜èªè©³ç´°ç”»é¢
    â†“ ç·¨é›†ãƒœã‚¿ãƒ³
å˜èªç·¨é›†ç”»é¢
    â†“ ä¿å­˜
å˜èªè©³ç´°ç”»é¢ã¸æˆ»ã‚‹ï¼ˆæ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ï¼‰
```

#### å®Ÿè£…æ™‚ã®æ³¨æ„

- å˜èªIDã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚Šã€Providerã‹ã‚‰è©²å½“å˜èªã‚’å–å¾—
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°: ä»–ã®æ“ä½œã§å˜èªãŒæ›´æ–°ã•ã‚ŒãŸå ´åˆã€è‡ªå‹•çš„ã«åæ˜ 
- å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯ `showDialog` ã§å®Ÿè£…

```dart
// å˜èªè©³ç´°ç”»é¢ã®å®Ÿè£…ä¾‹
class WordDetailScreen extends ConsumerWidget {
  final String wordId;

  const WordDetailScreen({required this.wordId});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final allWords = ref.watch(wordbookNotifierProvider).value ?? [];
    final word = allWords.firstWhere((w) => w.id == wordId);

    return Scaffold(
      appBar: AppBar(
        title: const Text('ë‹¨ì–´ ìƒì„¸'),
        actions: [
          IconButton(
            icon: const Icon(Icons.edit),
            onPressed: () => _navigateToEdit(context, word),
          ),
          IconButton(
            icon: const Icon(Icons.delete),
            onPressed: () => _showDeleteDialog(context, ref, word),
          ),
        ],
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
            StatusBadge(status: word.status),
            const SizedBox(height: 16),

            // å˜èª
            Text(word.word, style: headlineLarge),
            const SizedBox(height: 8),

            // æ„å‘³
            Text(word.meaning, style: titleMedium),
            const SizedBox(height: 16),

            // éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³
            FButton.icon(
              onPress: () => ref.read(wordAudioServiceProvider.notifier).speak(word.word),
              style: FButtonStyle.ghost(),
              child: const Icon(Icons.volume_up),
            ),

            // ä¾‹æ–‡ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»ã‚¿ã‚°ãƒ»ãƒ¡ã‚¿æƒ…å ±ãªã©...
          ],
        ),
      ),
    );
  }

  Future<void> _showDeleteDialog(
    BuildContext context,
    WidgetRef ref,
    Word word,
  ) async {
    final confirmed = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('å‰Šé™¤ç¢ºèª'),
        content: Text('ã€Œ${word.word}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context, false),
            child: const Text('ã‚­ãƒ£ãƒ³ã‚»ãƒ«'),
          ),
          TextButton(
            onPressed: () => Navigator.pop(context, true),
            child: const Text('å‰Šé™¤'),
          ),
        ],
      ),
    );

    if (confirmed == true) {
      try {
        await ref.read(wordbookNotifierProvider.notifier).deleteWord(word.id);
        if (context.mounted) {
          Navigator.pop(context);
        }
      } catch (e) {
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        showSnackBar('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }
  }
}
```

---

## 5. æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½

### 5.1 æ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```dart
List<Word> searchWords(List<Word> words, String query) {
  if (query.isEmpty) return words;

  final normalizedQuery = query.toLowerCase().trim();

  return words.where((word) {
    // å˜èªã§æ¤œç´¢
    if (word.word.toLowerCase().contains(normalizedQuery)) {
      return true;
    }

    // æ„å‘³ã§æ¤œç´¢
    if (word.meaning.toLowerCase().contains(normalizedQuery)) {
      return true;
    }

    // ä¾‹æ–‡ã§æ¤œç´¢
    if (word.example != null &&
        word.example!.toLowerCase().contains(normalizedQuery)) {
      return true;
    }

    // ã‚¿ã‚°ã§æ¤œç´¢
    for (final tag in word.tags) {
      if (tag.toLowerCase().contains(normalizedQuery)) {
        return true;
      }
    }

    return false;
  }).toList();
}
```

### 5.2 ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®çµ„ã¿åˆã‚ã›

ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¯ä»¥ä¸‹ã®é †åºã§é©ç”¨:
1. **ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªãƒ¼ã®ã¿è¡¨ç¤º
2. **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**: é¸æŠã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿è¡¨ç¤ºï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰
3. **æ¤œç´¢ã‚¯ã‚¨ãƒª**: å˜èªãƒ»æ„å‘³ãƒ»ä¾‹æ–‡ãƒ»ã‚¿ã‚°ã§çµã‚Šè¾¼ã¿

```dart
List<Word> applyFilters({
  required List<Word> words,
  required WordCategory category,
  required Set<WordStatus> statusFilters,
  required String searchQuery,
}) {
  var filtered = words;

  // 1. ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  filtered = filtered.where((w) => w.category == category).toList();

  // 2. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  if (statusFilters.isNotEmpty) {
    filtered = filtered.where((w) => statusFilters.contains(w.status)).toList();
  }

  // 3. æ¤œç´¢ã‚¯ã‚¨ãƒª
  filtered = searchWords(filtered, searchQuery);

  return filtered;
}
```

### 5.3 ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆä»Šå¾Œå®Ÿè£…äºˆå®šï¼‰

ã‚½ãƒ¼ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³:
- **ä½œæˆæ—¥æ™‚**: æ–°ã—ã„é † / å¤ã„é †
- **æ›´æ–°æ—¥æ™‚**: æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸé †
- **å¾©ç¿’å›æ•°**: å¤šã„é † / å°‘ãªã„é †
- **æ­£è§£ç‡**: é«˜ã„é † / ä½ã„é †
- **å˜èªå**: ã‚ã„ã†ãˆãŠé † / ã„±ã„´ã„·é †

---

## 6. éŸ³å£°å†ç”Ÿæ©Ÿèƒ½

### 6.1 éŸ³å£°å†ç”Ÿã®å®Ÿè£…æ–¹æ³•

**TTSï¼ˆText-to-Speechï¼‰ã®åˆ©ç”¨**:
- Flutter `flutter_tts` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨
- éŸ“å›½èªéŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æŒ‡å®šï¼ˆ`ko-KR`ï¼‰
- å†ç”Ÿé€Ÿåº¦ã®èª¿æ•´å¯èƒ½ï¼ˆ0.5x ~ 2.0xï¼‰

### 6.2 éŸ³å£°å†ç”Ÿã®æ¦‚è¦

éŸ³å£°å†ç”Ÿæ©Ÿèƒ½ã¯ä»¥ä¸‹ã®è¦ç´ ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š

- **TTS ã‚¨ãƒ³ã‚¸ãƒ³**: `flutter_tts` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- **è¨€èªè¨­å®š**: éŸ“å›½èªï¼ˆ`ko-KR`ï¼‰
- **éŸ³å£°è¨­å®š**: å†ç”Ÿé€Ÿåº¦ã€è‡ªå‹•å†ç”Ÿã€éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®é¸æŠãŒå¯èƒ½

**å®Ÿè£…ã®è©³ç´°**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Œ6.4 éŸ³å£°è¨­å®šã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚éŸ³å£°è¨­å®šã¨é€£å‹•ã—ãŸå®Œå…¨ãªå®Ÿè£…ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

### 6.3 UIçµ±åˆ

å˜èªã‚«ãƒ¼ãƒ‰ã‹ã‚‰éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹åŸºæœ¬çš„ãªä½¿ã„æ–¹:

```dart
class WordCard extends ConsumerWidget {
  final Word word;

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return FCard.raw(
      child: Column(
        children: [
          Text(word.word, style: headlineSmall),
          Text(word.meaning, style: bodyMedium),
          // éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³
          FButton.icon(
            onPress: () async {
              await ref.read(wordAudioServiceProvider.notifier).speak(word.word);
            },
            style: FButtonStyle.ghost(),
            child: const Icon(Icons.volume_up_outlined),
          ),
        ],
      ),
    );
  }
}
```

**æ³¨æ„**: `WordAudioService` ã¯Riverpodã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ã—ã¦ç®¡ç†ã•ã‚Œã¾ã™ï¼ˆ6.4ç¯€å‚ç…§ï¼‰ã€‚

### 6.4 éŸ³å£°è¨­å®š

#### è¨­å®šé …ç›®

| è¨­å®šé …ç›® | é¸æŠè‚¢ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|---------|-------|-------------|------|
| å†ç”Ÿé€Ÿåº¦ | 0.5x, 0.75x, 1.0x, 1.5x, 2.0x | 1.0x | éŸ³å£°ã®å†ç”Ÿé€Ÿåº¦ |
| è‡ªå‹•å†ç”Ÿ | ON / OFF | OFF | å˜èªã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚ã«è‡ªå‹•ã§éŸ³å£°å†ç”Ÿ |
| éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ | ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ³ã‚¸ãƒ³ | ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | TTSéŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®é¸æŠ |

#### è¨­å®šç”»é¢UI

è¨­å®šç”»é¢ï¼ˆ`settings_screen.dart`ï¼‰ã«ã€ŒéŸ³å£°è¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨­å®š                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éŸ³å£°è¨­å®š                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  å†ç”Ÿé€Ÿåº¦                        â”‚
â”‚  [ 1.0x            â–¼]          â”‚  â† ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
â”‚                                 â”‚
â”‚  è‡ªå‹•å†ç”Ÿ                        â”‚
â”‚  [          ğŸ”˜ OFF]            â”‚  â† ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ
â”‚                                 â”‚
â”‚  éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³                    â”‚
â”‚  [ ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ â–¼]        â”‚  â† ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```dart
@freezed
class AudioSettings with _$AudioSettings {
  const factory AudioSettings({
    @Default(1.0) double speechRate,      // 0.5 ~ 2.0
    @Default(false) bool autoPlay,        // è‡ªå‹•å†ç”ŸON/OFF
    String? voiceEngine,                  // éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³åï¼ˆnullã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
  }) = _AudioSettings;

  factory AudioSettings.fromJson(Map<String, dynamic> json)
      => _$AudioSettingsFromJson(json);
}
```

#### æ°¸ç¶šåŒ–

**ä¿å­˜å…ˆ**: SharedPreferences
**ã‚­ãƒ¼å**: `audio_settings_v1`
**å½¢å¼**: JSONæ–‡å­—åˆ—

```dart
// ä¿å­˜
Future<void> saveAudioSettings(AudioSettings settings) async {
  final prefs = await SharedPreferences.getInstance();
  final json = jsonEncode(settings.toJson());
  await prefs.setString('audio_settings_v1', json);
}

// èª­ã¿è¾¼ã¿
Future<AudioSettings> loadAudioSettings() async {
  final prefs = await SharedPreferences.getInstance();
  final json = prefs.getString('audio_settings_v1');

  if (json == null) {
    return const AudioSettings();  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  }

  final data = jsonDecode(json) as Map<String, dynamic>;
  return AudioSettings.fromJson(data);
}
```

#### çŠ¶æ…‹ç®¡ç†ï¼ˆRiverpodï¼‰

```dart
@riverpod
class AudioSettingsNotifier extends _$AudioSettingsNotifier {
  static const _cacheKey = 'audio_settings_v1';

  @override
  FutureOr<AudioSettings> build() async {
    // èµ·å‹•æ™‚ã«SharedPreferencesã‹ã‚‰èª­ã¿è¾¼ã¿
    final prefs = await SharedPreferences.getInstance();
    final json = prefs.getString(_cacheKey);

    if (json == null) {
      return const AudioSettings();  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
    }

    final data = jsonDecode(json) as Map<String, dynamic>;
    return AudioSettings.fromJson(data);
  }

  /// å†ç”Ÿé€Ÿåº¦ã‚’å¤‰æ›´
  Future<void> setSpeechRate(double rate) async {
    final current = state.value ?? const AudioSettings();
    final updated = current.copyWith(speechRate: rate);

    state = AsyncData(updated);
    await _save(updated);

    // WordAudioServiceã«åæ˜ 
    await ref.read(wordAudioServiceProvider.notifier).setSpeechRate(rate);
  }

  /// è‡ªå‹•å†ç”Ÿã‚’å¤‰æ›´
  Future<void> setAutoPlay(bool autoPlay) async {
    final current = state.value ?? const AudioSettings();
    final updated = current.copyWith(autoPlay: autoPlay);

    state = AsyncData(updated);
    await _save(updated);
  }

  /// éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å¤‰æ›´
  Future<void> setVoiceEngine(String? engine) async {
    final current = state.value ?? const AudioSettings();
    final updated = current.copyWith(voiceEngine: engine);

    state = AsyncData(updated);
    await _save(updated);

    // WordAudioServiceã«åæ˜ 
    await ref.read(wordAudioServiceProvider.notifier).setVoiceEngine(engine);
  }

  Future<void> _save(AudioSettings settings) async {
    final prefs = await SharedPreferences.getInstance();
    final json = jsonEncode(settings.toJson());
    await prefs.setString(_cacheKey, json);
  }
}
```

#### WordAudioServiceã¨ã®é€£æºï¼ˆæœ€çµ‚ç‰ˆå®Ÿè£…ï¼‰

**æ³¨æ„**: ã“ã‚ŒãŒ `WordAudioService` ã®æœ€çµ‚çš„ãªå®Ÿè£…ã§ã™ã€‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³6.2ã‚„7.1.4ã¯ã“ã®å®Ÿè£…ã¸ã®å‚ç…§ã¨ãªã£ã¦ã„ã¾ã™ã€‚

`WordAudioService` ã®åˆæœŸåŒ–æ™‚ã«è¨­å®šã‚’é©ç”¨:

```dart
@riverpod
class WordAudioService extends _$WordAudioService {
  FlutterTts? _tts;

  @override
  FutureOr<void> build() async {
    _tts = FlutterTts();

    // éŸ³å£°è¨­å®šã‚’èª­ã¿è¾¼ã‚“ã§é©ç”¨
    final settings = await ref.read(audioSettingsNotifierProvider.future);
    await _tts!.setLanguage('ko-KR');
    await _tts!.setSpeechRate(settings.speechRate);
    await _tts!.setVolume(1.0);
    await _tts!.setPitch(1.0);

    if (settings.voiceEngine != null) {
      await _tts!.setVoice({'name': settings.voiceEngine});
    }

    ref.onDispose(() {
      _tts?.stop();
    });
  }

  Future<void> speak(String text) async {
    await _tts?.speak(text);
  }

  Future<void> stop() async {
    await _tts?.stop();
  }

  Future<void> setSpeechRate(double rate) async {
    await _tts?.setSpeechRate(rate);
  }

  Future<void> setVoiceEngine(String? engine) async {
    if (engine != null) {
      await _tts?.setVoice({'name': engine});
    }
  }
}
```

#### è‡ªå‹•å†ç”Ÿã®å®Ÿè£…

å˜èªã‚«ãƒ¼ãƒ‰ã‚¿ãƒƒãƒ—æ™‚ã«è‡ªå‹•å†ç”Ÿã™ã‚‹å ´åˆ:

```dart
void _onWordCardTap(Word word) async {
  // è©³ç´°ç”»é¢ã¸é·ç§»
  Navigator.push(
    context,
    MaterialPageRoute(
      builder: (_) => WordDetailScreen(wordId: word.id),
    ),
  );

  // è‡ªå‹•å†ç”Ÿè¨­å®šã‚’ç¢ºèª
  final settings = await ref.read(audioSettingsNotifierProvider.future);
  if (settings.autoPlay) {
    await ref.read(wordAudioServiceProvider.notifier).speak(word.word);
  }
}
```

---

## 7. çŠ¶æ…‹ç®¡ç†ï¼ˆRiverpodè¨­è¨ˆï¼‰

### 7.1 å¿…è¦ãªãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

#### 1. WordbookRepository - APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```dart
class WordbookRepository {
  WordbookRepository({required ApiClientService apiClient})
      : _apiClient = apiClient;

  final ApiClientService _apiClient;

  /// å˜èªä¸€è¦§ã‚’å–å¾—ï¼ˆå…¨ä»¶å–å¾—ï¼‰
  /// limitã¨offsetã‚’æŒ‡å®šã—ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨å˜èªã‚’å–å¾—
  Future<List<Word>> fetchWords() async {
    try {
      // limitã¨offsetã‚’æŒ‡å®šã—ãªã„ã“ã¨ã§å…¨ä»¶å–å¾—
      final response = await _apiClient.dio.get('/api/wordbook');
      final data = response.data['data'] as List<dynamic>;
      return data.map((json) => Word.fromJson(json)).toList();
    } on DioException catch (error, stackTrace) {
      AppLogger.error(
        'Failed to fetch words',
        tag: 'WordbookRepository',
        error: error,
        stackTrace: stackTrace,
      );
      throw ApiClientService.handleDioException(error);
    }
  }

  /// å˜èªã‚’è¿½åŠ 
  Future<Word> createWord({
    required String word,
    required String meaning,
    String? example,
    required WordCategory category,
    required WordStatus status,
    List<String> tags = const [],
  }) async {
    try {
      final response = await _apiClient.dio.post(
        '/api/wordbook',
        data: {
          'word': word,
          'meaning': meaning,
          if (example != null) 'example': example,
          'category': category.name.toUpperCase(),
          'status': status.name.toUpperCase(),
          'tags': tags,
        },
      );
      return Word.fromJson(response.data as Map<String, dynamic>);
    } on DioException catch (error, stackTrace) {
      AppLogger.error(
        'Failed to create word',
        tag: 'WordbookRepository',
        error: error,
        stackTrace: stackTrace,
      );
      throw ApiClientService.handleDioException(error);
    }
  }

  /// å˜èªã‚’æ›´æ–°
  Future<Word> updateWord({
    required String id,
    String? word,
    String? meaning,
    String? example,
    WordCategory? category,
    WordStatus? status,
    List<String>? tags,
  }) async {
    try {
      final response = await _apiClient.dio.put(
        '/api/wordbook/$id',
        data: {
          if (word != null) 'word': word,
          if (meaning != null) 'meaning': meaning,
          if (example != null) 'example': example,
          if (category != null) 'category': category.name.toUpperCase(),
          if (status != null) 'status': status.name.toUpperCase(),
          if (tags != null) 'tags': tags,
        },
      );
      return Word.fromJson(response.data as Map<String, dynamic>);
    } on DioException catch (error, stackTrace) {
      AppLogger.error(
        'Failed to update word',
        tag: 'WordbookRepository',
        error: error,
        stackTrace: stackTrace,
      );
      throw ApiClientService.handleDioException(error);
    }
  }

  /// å˜èªã‚’å‰Šé™¤
  Future<void> deleteWord(String id) async {
    try {
      await _apiClient.dio.delete('/api/wordbook/$id');
    } on DioException catch (error, stackTrace) {
      AppLogger.error(
        'Failed to delete word',
        tag: 'WordbookRepository',
        error: error,
        stackTrace: stackTrace,
      );
      throw ApiClientService.handleDioException(error);
    }
  }
}
```

#### 2. WordbookProvider - å˜èªä¸€è¦§ã®ç®¡ç†

```dart
@riverpod
class WordbookNotifier extends _$WordbookNotifier {
  static const _cacheKey = 'wordbook_cache_v1';

  @override
  FutureOr<List<Word>> build() async {
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰èª­ã¿è¾¼ã¿
    final prefs = await SharedPreferences.getInstance();
    final cached = prefs.getString(_cacheKey);
    final cachedWords = cached != null ? _parseWords(cached) : <Word>[];

    // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    _syncFromServer(cachedWords);

    return cachedWords;
  }

  Future<void> _syncFromServer(List<Word> cachedWords) async {
    try {
      final repository = ref.read(wordbookRepositoryProvider);
      final serverWords = await repository.fetchWords();

      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã‚’ç¢ºèªã—ã¦ã€æœªåŒæœŸã®å˜èªã‚’ä¿æŒ
      final offlineQueue = await ref.read(offlineQueueProvider.future);
      final mergedWords = _mergeWithOfflineData(
        serverWords: serverWords,
        cachedWords: cachedWords,
        offlineQueue: offlineQueue,
      );

      // ãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã§æ›´æ–°
      state = AsyncData(mergedWords);
      await _saveToCache(mergedWords);
    } catch (e) {
      // ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ãã®ã¾ã¾ä½¿ç”¨
      AppLogger.warning('Failed to sync words from server', error: e);
    }
  }

  /// ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸
  ///
  /// ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œï¼ˆCREATE/UPDATE/DELETEï¼‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«å„ªå…ˆã§ä¿è­·ã—ã¾ã™:
  /// - CREATE: tempIdã®å˜èªã‚’ä¿æŒ
  /// - UPDATE: ãƒ­ãƒ¼ã‚«ãƒ«ã®ç·¨é›†å†…å®¹ã§ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ã
  /// - DELETE: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é™¤å¤–
  List<Word> _mergeWithOfflineData({
    required List<Word> serverWords,
    required List<Word> cachedWords,
    required List<PendingOperation> offlineQueue,
  }) {
    var mergedWords = [...serverWords];

    // 1. CREATEæ“ä½œ: tempIdã®å˜èªã‚’è¿½åŠ 
    final createOps = offlineQueue.where((op) => op.operationType == 'CREATE');
    final pendingTempIds = createOps.map((op) => op.tempId).toSet();

    final tempWords = cachedWords
        .where((word) => word.id.startsWith('temp_'))
        .where((word) => pendingTempIds.contains(word.id))
        .toList();

    mergedWords.addAll(tempWords);

    // 2. UPDATEæ“ä½œ: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã®ç·¨é›†å†…å®¹ã§ä¸Šæ›¸ã
    final updateOps = offlineQueue.where((op) => op.operationType == 'UPDATE');
    for (final op in updateOps) {
      final wordId = op.wordId;
      if (wordId == null) continue;

      final localWord = cachedWords.firstWhereOrNull((w) => w.id == wordId);
      if (localWord != null) {
        // ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®è©²å½“è¦ç´ ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã®å€¤ã§ç½®ãæ›ãˆ
        final index = mergedWords.indexWhere((w) => w.id == wordId);
        if (index != -1) {
          mergedWords[index] = localWord;
        }
      }
    }

    // 3. DELETEæ“ä½œ: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é™¤å¤–
    final deleteOps = offlineQueue.where((op) => op.operationType == 'DELETE');
    final deleteIds = deleteOps.map((op) => op.wordId).whereType<String>().toSet();

    mergedWords = mergedWords.where((word) => !deleteIds.contains(word.id)).toList();

    return mergedWords;
  }

  Future<void> _saveToCache(List<Word> words) async {
    final prefs = await SharedPreferences.getInstance();
    final json = jsonEncode(words.map((w) => w.toJson()).toList());
    await prefs.setString(_cacheKey, json);
  }

  List<Word> _parseWords(String json) {
    final data = jsonDecode(json) as List<dynamic>;
    return data.map((json) => Word.fromJson(json)).toList();
  }

  /// å˜èªã‚’è¿½åŠ ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œç‰ˆï¼‰
  Future<void> addWord({
    required String word,
    required String meaning,
    String? example,
    required WordCategory category,
    required WordStatus status,
    List<String> tags = const [],
  }) async {
    try {
      // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
      final connectivity = await Connectivity().checkConnectivity();
      final isOnline = connectivity != ConnectivityResult.none;

      if (isOnline) {
        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³: ç›´æ¥APIã«POST
        final repository = ref.read(wordbookRepositoryProvider);
        final newWord = await repository.createWord(
          word: word,
          meaning: meaning,
          example: example,
          category: category,
          status: status,
          tags: tags,
        );

        // çŠ¶æ…‹ã‚’æ›´æ–°
        final currentWords = state.value ?? [];
        state = AsyncData([newWord, ...currentWords]);
        await _saveToCache([newWord, ...currentWords]);

        _showSnackBar('å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸ');
      } else {
        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³: ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜
        await _saveToOfflineQueue(
          word: word,
          meaning: meaning,
          example: example,
          category: category,
          status: status,
          tags: tags,
        );
      }
    } catch (e, stackTrace) {
      AppLogger.error(
        'Failed to add word',
        tag: 'WordbookNotifier',
        error: e,
        stackTrace: stackTrace,
      );
      _showSnackBar('å˜èªã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
      rethrow;
    }
  }

  /// å˜èªã‚’æ›´æ–°
  Future<void> updateWord({
    required String id,
    String? word,
    String? meaning,
    String? example,
    WordCategory? category,
    WordStatus? status,
    List<String>? tags,
  }) async {
    final repository = ref.read(wordbookRepositoryProvider);
    final updatedWord = await repository.updateWord(
      id: id,
      word: word,
      meaning: meaning,
      example: example,
      category: category,
      status: status,
      tags: tags,
    );

    // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    final currentWords = state.value ?? [];
    final index = currentWords.indexWhere((w) => w.id == id);
    if (index != -1) {
      final newWords = [...currentWords];
      newWords[index] = updatedWord;
      state = AsyncData(newWords);
      await _saveToCache(newWords);
    }
  }

  /// å˜èªã‚’å‰Šé™¤
  Future<void> deleteWord(String id) async {
    final repository = ref.read(wordbookRepositoryProvider);
    await repository.deleteWord(id);

    // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    final currentWords = state.value ?? [];
    final newWords = currentWords.where((w) => w.id != id).toList();
    state = AsyncData(newWords);
    await _saveToCache(newWords);
  }
}

@riverpod
WordbookRepository wordbookRepository(Ref ref) {
  final apiClient = ref.watch(apiClientServiceProvider);
  return WordbookRepository(apiClient: apiClient);
}
```

#### 3. FilteredWordsProvider - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¸ˆã¿å˜èªä¸€è¦§

```dart
@riverpod
class FilteredWords extends _$FilteredWords {
  @override
  List<Word> build({
    required WordCategory category,
    required Set<WordStatus> statusFilters,
    required String searchQuery,
  }) {
    final allWords = ref.watch(wordbookNotifierProvider).value ?? [];

    return _applyFilters(
      words: allWords,
      category: category,
      statusFilters: statusFilters,
      searchQuery: searchQuery,
    );
  }

  List<Word> _applyFilters({
    required List<Word> words,
    required WordCategory category,
    required Set<WordStatus> statusFilters,
    required String searchQuery,
  }) {
    var filtered = words;

    // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    filtered = filtered.where((w) => w.category == category).toList();

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    if (statusFilters.isNotEmpty) {
      filtered = filtered.where((w) => statusFilters.contains(w.status)).toList();
    }

    // æ¤œç´¢ã‚¯ã‚¨ãƒª
    if (searchQuery.isNotEmpty) {
      final query = searchQuery.toLowerCase();
      filtered = filtered.where((w) {
        return w.word.toLowerCase().contains(query) ||
               w.meaning.toLowerCase().contains(query) ||
               (w.example?.toLowerCase().contains(query) ?? false) ||
               w.tags.any((tag) => tag.toLowerCase().contains(query));
      }).toList();
    }

    return filtered;
  }
}
```

#### 4. WordAudioServiceProvider - éŸ³å£°å†ç”Ÿã‚µãƒ¼ãƒ“ã‚¹

**å®Ÿè£…**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Œ6.4.4 WordAudioServiceã¨ã®é€£æºã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

éŸ³å£°è¨­å®šï¼ˆAudioSettingsï¼‰ã¨é€£å‹•ã—ãŸå®Œå…¨ãªå®Ÿè£…ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸»ãªæ©Ÿèƒ½ï¼š

- éŸ³å£°è¨­å®šã®è‡ªå‹•èª­ã¿è¾¼ã¿ã¨é©ç”¨
- å†ç”Ÿé€Ÿåº¦ã®å‹•çš„å¤‰æ›´
- éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
- Riverpodã«ã‚ˆã‚‹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼ˆ`ref.onDispose`ï¼‰

#### 5. OfflineQueueProvider - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ç®¡ç†

ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œï¼ˆCREATE/UPDATE/DELETEï¼‰ã‚’ç®¡ç†ã™ã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã§ã™ã€‚

```dart
@riverpod
class OfflineQueueNotifier extends _$OfflineQueueNotifier {
  static const _queueKey = 'wordbook_offline_queue_v1';

  @override
  FutureOr<List<PendingOperation>> build() async {
    // SharedPreferencesã‹ã‚‰ã‚­ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¿
    return await loadQueue();
  }

  /// ã‚­ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¿
  Future<List<PendingOperation>> loadQueue() async {
    final prefs = await SharedPreferences.getInstance();
    final json = prefs.getString(_queueKey);

    if (json == null) return [];

    final data = jsonDecode(json) as List<dynamic>;
    return data.map((item) => PendingOperation.fromJson(item)).toList();
  }

  /// ã‚­ãƒ¥ãƒ¼ã‚’ä¿å­˜
  Future<void> _saveQueue(List<PendingOperation> queue) async {
    final prefs = await SharedPreferences.getInstance();
    final json = jsonEncode(queue.map((op) => op.toJson()).toList());
    await prefs.setString(_queueKey, json);
  }

  /// ã‚­ãƒ¥ãƒ¼ã«æ“ä½œã‚’è¿½åŠ 
  Future<void> addOperation(PendingOperation operation) async {
    final currentQueue = state.value ?? [];

    // é‡è¤‡ãƒã‚§ãƒƒã‚¯
    final isDuplicate = currentQueue.any((op) {
      if (operation.operationType == 'CREATE') {
        return op.tempId == operation.tempId;
      } else {
        return op.wordId == operation.wordId &&
               op.operationType == operation.operationType;
      }
    });

    if (!isDuplicate) {
      final updatedQueue = [...currentQueue, operation];
      state = AsyncData(updatedQueue);
      await _saveQueue(updatedQueue);
    }
  }

  /// ã‚­ãƒ¥ãƒ¼ã‹ã‚‰æ“ä½œã‚’å‰Šé™¤
  Future<void> removeOperation(String operationId) async {
    final currentQueue = state.value ?? [];
    final updatedQueue = currentQueue.where((op) => op.id != operationId).toList();

    state = AsyncData(updatedQueue);
    await _saveQueue(updatedQueue);
  }

  /// ã‚­ãƒ¥ãƒ¼å†…ã®æ“ä½œã‚’æ›´æ–°
  Future<void> updateOperation(String operationId, PendingOperation updated) async {
    final currentQueue = state.value ?? [];
    final index = currentQueue.indexWhere((op) => op.id == operationId);

    if (index != -1) {
      final updatedQueue = [...currentQueue];
      updatedQueue[index] = updated;

      state = AsyncData(updatedQueue);
      await _saveQueue(updatedQueue);
    }
  }

  /// ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³9.4.3ã®è©³ç´°å®Ÿè£…ã‚’ä½¿ç”¨ï¼‰
  Future<void> processQueue() async {
    final queue = state.value ?? [];
    final pendingOperations = [...queue];

    for (final operation in pendingOperations) {
      // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ãƒã‚§ãƒƒã‚¯
      if (operation.retryCount >= 3) {
        AppLogger.warning('Max retry count reached for operation ${operation.id}');
        await removeOperation(operation.id);
        continue;
      }

      // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã®è¨ˆç®—
      final backoffDelay = Duration(seconds: pow(2, operation.retryCount).toInt());
      if (operation.lastAttemptAt != null &&
          DateTime.now().difference(operation.lastAttemptAt!) < backoffDelay) {
        continue;
      }

      try {
        // WordbookNotifierã®_executeOperationã‚’å‘¼ã³å‡ºã™
        await ref.read(wordbookNotifierProvider.notifier)
            ._executeOperation(operation);

        // æˆåŠŸ: ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
        await removeOperation(operation.id);
      } catch (e) {
        // å¤±æ•—: ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’å¢—ã‚„ã—ã¦ä¿å­˜
        final updatedOperation = operation.copyWith(
          retryCount: operation.retryCount + 1,
          lastAttemptAt: DateTime.now(),
        );
        await updateOperation(operation.id, updatedOperation);
      }
    }
  }
}
```

**ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ä¸»ãªè²¬å‹™**:

1. **ã‚­ãƒ¥ãƒ¼ã®æ°¸ç¶šåŒ–**: SharedPreferencesã¨ã®åŒæœŸ
2. **æ“ä½œã®ç®¡ç†**: è¿½åŠ ã€å‰Šé™¤ã€æ›´æ–°
3. **é‡è¤‡é˜²æ­¢**: åŒã˜æ“ä½œãŒè¤‡æ•°å›è¿½åŠ ã•ã‚Œãªã„ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯
4. **ãƒªãƒˆãƒ©ã‚¤å‡¦ç†**: æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤

**ä»–ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ã®é€£æº**:

- `WordbookNotifier`: ã‚­ãƒ¥ãƒ¼å‡¦ç†æ™‚ã« `_executeOperation` ã‚’å‘¼ã³å‡ºã™
- `Connectivity`: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚ã« `processQueue()` ã‚’è‡ªå‹•å®Ÿè¡Œ

**ä½¿ç”¨ä¾‹**:

```dart
// ã‚­ãƒ¥ãƒ¼ã«æ“ä½œã‚’è¿½åŠ 
await ref.read(offlineQueueNotifierProvider.notifier).addOperation(
  PendingOperation(
    id: Uuid().v4(),
    operationType: 'CREATE',
    tempId: tempId,
    data: {...},
    createdAt: DateTime.now(),
  ),
);

// ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†
await ref.read(offlineQueueNotifierProvider.notifier).processQueue();

// ã‚­ãƒ¥ãƒ¼ã®çŠ¶æ…‹ã‚’ç›£è¦–
final queueCount = ref.watch(
  offlineQueueNotifierProvider.select((queue) => queue.value?.length ?? 0),
);
```

---

## 8. APIä»•æ§˜

### 8.1 GET /api/wordbook - å˜èªä¸€è¦§å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```http
GET /api/wordbook
Authorization: Bearer {token}
```

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `category` | String? | ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ`MY_WORDS`, `EXAMPLES`, `IDIOMS`ï¼‰ |
| `status` | String? | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆ`MASTERED`, `REVIEWING`, `NEEDS_REVIEW`ï¼‰ |
| `limit` | Int? | å–å¾—ä»¶æ•°ï¼ˆæœªæŒ‡å®šã®å ´åˆã¯å…¨ä»¶å–å¾—ï¼‰ |
| `offset` | Int? | ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã€limitã¨ä½µç”¨ï¼‰ |

**æ³¨æ„**:
- **å…¨ä»¶å–å¾—**: `limit`ã¨`offset`ã‚’æŒ‡å®šã—ãªã„å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨å˜èªã‚’å–å¾—ã—ã¾ã™ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®å…¨ä»¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ–¹é‡ï¼‰
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: `limit`ã¨`offset`ã‚’æŒ‡å®šã—ãŸå ´åˆã€æŒ‡å®šç¯„å›²ã®ã¿å–å¾—ã—ã¾ã™ï¼ˆå°†æ¥ã®å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œç”¨ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆå…¨ä»¶å–å¾—ã®å ´åˆï¼‰**:
```json
{
  "data": [
    {
      "id": "clx1234abcd",
      "userId": "user_abc123",
      "word": "ì•ˆë…•í•˜ì„¸ìš”",
      "meaning": "ã“ã‚“ã«ã¡ã¯",
      "example": "ì•ˆë…•í•˜ì„¸ìš”? ì˜¤ëŠ˜ë„ ì—´ê³µí•´ìš”!",
      "status": "MASTERED",
      "category": "MY_WORDS",
      "lastReviewedAt": "2024-03-15T10:30:00Z",
      "reviewCount": 5,
      "successRate": 0.95,
      "tags": ["æŒ¨æ‹¶", "åŸºæœ¬è¡¨ç¾"],
      "createdAt": "2024-01-01T00:00:00Z",
      "updatedAt": "2024-03-15T10:30:00Z"
    }
  ],
  "total": 42
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä½¿ç”¨æ™‚ï¼‰**:
```json
{
  "data": [...],
  "pagination": {
    "total": 42,
    "limit": 20,
    "offset": 0
  }
}
```

### 8.2 POST /api/wordbook - å˜èªè¿½åŠ 

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```http
POST /api/wordbook
Authorization: Bearer {token}
Content-Type: application/json

{
  "word": "ì„¤ë ˆë‹¤",
  "meaning": "ã¨ãã‚ã",
  "example": "ë‚´ì¼ í•œêµ­ ì—¬í–‰ì´ë¼ ì„¤ë ˆìš”.",
  "category": "MY_WORDS",
  "status": "REVIEWING",
  "tags": ["æ„Ÿæƒ…", "æ—¥å¸¸ä¼šè©±"]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "id": "clx5678efgh",
  "userId": "user_abc123",
  "word": "ì„¤ë ˆë‹¤",
  "meaning": "ã¨ãã‚ã",
  "example": "ë‚´ì¼ í•œêµ­ ì—¬í–‰ì´ë¼ ì„¤ë ˆìš”.",
  "status": "REVIEWING",
  "category": "MY_WORDS",
  "lastReviewedAt": null,
  "reviewCount": 0,
  "successRate": 0,
  "tags": ["æ„Ÿæƒ…", "æ—¥å¸¸ä¼šè©±"],
  "createdAt": "2024-03-20T14:00:00Z",
  "updatedAt": "2024-03-20T14:00:00Z"
}
```

### 8.3 PUT /api/wordbook/{id} - å˜èªæ›´æ–°

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```http
PUT /api/wordbook/clx5678efgh
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "MASTERED",
  "reviewCount": 3,
  "successRate": 1.0
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "id": "clx5678efgh",
  "userId": "user_abc123",
  "word": "ì„¤ë ˆë‹¤",
  "meaning": "ã¨ãã‚ã",
  "example": "ë‚´ì¼ í•œêµ­ ì—¬í–‰ì´ë¼ ì„¤ë ˆìš”.",
  "status": "MASTERED",
  "category": "MY_WORDS",
  "lastReviewedAt": "2024-03-21T10:00:00Z",
  "reviewCount": 3,
  "successRate": 1.0,
  "tags": ["æ„Ÿæƒ…", "æ—¥å¸¸ä¼šè©±"],
  "createdAt": "2024-03-20T14:00:00Z",
  "updatedAt": "2024-03-21T10:00:00Z"
}
```

### 8.4 DELETE /api/wordbook/{id} - å˜èªå‰Šé™¤

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```http
DELETE /api/wordbook/clx5678efgh
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "message": "Word deleted successfully"
}
```

### 8.5 GET /api/wordbook/stats - çµ±è¨ˆæƒ…å ±å–å¾—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```http
GET /api/wordbook/stats
Authorization: Bearer {token}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "totalWords": 42,
  "byCategory": {
    "MY_WORDS": 25,
    "EXAMPLES": 12,
    "IDIOMS": 5
  },
  "byStatus": {
    "MASTERED": 15,
    "REVIEWING": 20,
    "NEEDS_REVIEW": 7
  },
  "averageSuccessRate": 0.85,
  "totalReviewCount": 128
}
```

### 8.6 ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å®šç¾©

å…¨ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

#### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
    "details": {}  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: è©³ç´°æƒ…å ±
  }
}
```

#### HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹ |
|---------------|-------------|------|-------------|
| 400 | `VALIDATION_ERROR` | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™ |
| 401 | `UNAUTHORIZED` | èªè¨¼ã‚¨ãƒ©ãƒ¼ | ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ |
| 403 | `FORBIDDEN` | æ¨©é™ã‚¨ãƒ©ãƒ¼ | ã“ã®æ“ä½œã‚’è¡Œã†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ |
| 404 | `NOT_FOUND` | ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | å˜èªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ |
| 409 | `DUPLICATE_ERROR` | é‡è¤‡ã‚¨ãƒ©ãƒ¼ | ã“ã®å˜èªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ |
| 500 | `INTERNAL_SERVER_ERROR` | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ |

#### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®è©³ç´°

`VALIDATION_ERROR` ã®å ´åˆã€`details` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å„é …ç›®ã®ã‚¨ãƒ©ãƒ¼ã‚’å«ã‚ã¾ã™ã€‚

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™",
    "details": {
      "word": "å˜èªã¯å¿…é ˆã§ã™",
      "meaning": "æ„å‘³ã¯å¿…é ˆã§ã™",
      "tags": "ã‚¿ã‚°ã¯æœ€å¤§10å€‹ã¾ã§ã§ã™"
    }
  }
}
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä¾‹ï¼ˆFlutterï¼‰

```dart
try {
  await ref.read(wordbookNotifierProvider.notifier).addWord(
    word: word,
    meaning: meaning,
    // ...
  );
} on DioException catch (e) {
  final statusCode = e.response?.statusCode;
  final errorData = e.response?.data;

  if (statusCode == 400 && errorData?['error']['code'] == 'VALIDATION_ERROR') {
    // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
    final details = errorData['error']['details'] as Map<String, dynamic>;
    showValidationErrors(details);
  } else if (statusCode == 409) {
    // é‡è¤‡ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
    showSnackBar('ã“ã®å˜èªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚');
  } else {
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
    final message = errorData?['error']['message'] ?? 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
    showSnackBar(message);
  }
}
```

---

## 9. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 9.1 å˜èªä¸€è¦§è¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```
[ã‚¢ãƒ—ãƒªèµ·å‹•]
    â†“
WordbookNotifierProvider.build()
    â†“
1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰èª­ã¿è¾¼ã¿
    â†“ SharedPreferences
    â†“
[å³åº§ã«UIã«è¡¨ç¤º]ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ï¼‰
    â†“
2. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—
    â†“ GET /api/wordbook
    â†“
3. ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸
    â†“
[UIã‚’æ›´æ–°]ï¼ˆæœ€æ–°ãƒ‡ãƒ¼ã‚¿ï¼‰
    â†“
4. ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
    â†“ SharedPreferences
```

### 9.2 å˜èªè¿½åŠ ãƒ•ãƒ­ãƒ¼

```
[è¿½åŠ ç”»é¢]
    â†“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›
    â†“ ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â†“ æˆåŠŸ
    â†“
WordbookNotifier.addWord()
    â†“
1. POST /api/wordbook
    â†“ ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
    â†“
2. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚‹
    â†“
3. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    â†“ state = AsyncData([...currentWords, newWord])
    â†“
4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    â†“ SharedPreferences
    â†“
[ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹]
    â†“
[æ–°ã—ã„å˜èªãŒè¡¨ç¤ºã•ã‚Œã‚‹]
```

### 9.3 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªè¿½åŠ ãƒ•ãƒ­ãƒ¼

```
[è¿½åŠ ç”»é¢]
    â†“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›
    â†“ ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â†“ æˆåŠŸ
    â†“
WordbookNotifier.addWord()
    â†“
1. POST /api/wordbookï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ï¼‰
    â†“ DioException: No internet connection
    â†“
2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
    â†“ OfflineQueue.add(PendingWord)
    â†“
3. ä¸€æ™‚IDã§ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    â†“ state = AsyncData([...currentWords, tempWord])
    â†“
4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    â†“ SharedPreferences
    â†“
[ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹]
    â†“
[æ–°ã—ã„å˜èªãŒè¡¨ç¤ºã•ã‚Œã‚‹]ï¼ˆä¸€æ™‚IDï¼‰
    â†“
[ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°]
    â†“
OfflineQueue.processQueue()
    â†“
POST /api/wordbookï¼ˆãƒªãƒˆãƒ©ã‚¤ï¼‰
    â†“
æˆåŠŸ: ä¸€æ™‚IDã‚’æœ¬ç‰©ã®IDã«ç½®ãæ›ãˆ
```

### 9.4 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã®è©³ç´°ä»•æ§˜

ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®æ“ä½œã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®ã€å¾…æ©Ÿã‚­ãƒ¥ãƒ¼ã®å®Ÿè£…ä»•æ§˜ã§ã™ã€‚

#### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```dart
@freezed
class PendingOperation with _$PendingOperation {
  const factory PendingOperation({
    required String id,                // æ“ä½œã®ä¸€æ„IDï¼ˆUUIDï¼‰
    required String operationType,     // 'CREATE' | 'UPDATE' | 'DELETE'
    String? tempId,                    // ä¸€æ™‚IDï¼ˆCREATEã®å ´åˆã®ã¿å¿…é ˆï¼‰
    String? wordId,                    // å˜èªIDï¼ˆUPDATE/DELETEã®å ´åˆã®ã¿å¿…é ˆï¼‰
    required Map<String, dynamic> data, // é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
    required DateTime createdAt,       // ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚ŒãŸæ—¥æ™‚
    @Default(0) int retryCount,        // ãƒªãƒˆãƒ©ã‚¤å›æ•°
    DateTime? lastAttemptAt,           // æœ€å¾Œã®è©¦è¡Œæ—¥æ™‚
  }) = _PendingOperation;

  factory PendingOperation.fromJson(Map<String, dynamic> json)
      => _$PendingOperationFromJson(json);
}
```

**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é‹ç”¨ãƒ«ãƒ¼ãƒ«**:

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | CREATE | UPDATE | DELETE |
|-----------|--------|--------|--------|
| `id` | å¿…é ˆ | å¿…é ˆ | å¿…é ˆ |
| `operationType` | `'CREATE'` | `'UPDATE'` | `'DELETE'` |
| `tempId` | **å¿…é ˆ** | null | null |
| `wordId` | null | **å¿…é ˆ** | **å¿…é ˆ** |
| `data` | å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å¤‰æ›´ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ | ç©º `{}` |

#### ä¿å­˜å…ˆ

**SharedPreferences ã‚’ä½¿ç”¨**:
- ã‚­ãƒ¼å: `wordbook_offline_queue_v1`
- å½¢å¼: JSONæ–‡å­—åˆ—ã®é…åˆ—

```dart
// ä¿å­˜
Future<void> saveQueue(List<PendingOperation> queue) async {
  final prefs = await SharedPreferences.getInstance();
  final json = jsonEncode(queue.map((op) => op.toJson()).toList());
  await prefs.setString('wordbook_offline_queue_v1', json);
}

// èª­ã¿è¾¼ã¿
Future<List<PendingOperation>> loadQueue() async {
  final prefs = await SharedPreferences.getInstance();
  final json = prefs.getString('wordbook_offline_queue_v1');
  if (json == null) return [];

  final data = jsonDecode(json) as List<dynamic>;
  return data.map((item) => PendingOperation.fromJson(item)).toList();
}
```

#### å†é€ãƒˆãƒªã‚¬ãƒ¼

ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†:

1. **ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚**
   ```dart
   @override
   void initState() {
     super.initState();
     WidgetsBinding.instance.addPostFrameCallback((_) {
       ref.read(offlineQueueProvider.notifier).processQueue();
     });
   }
   ```

2. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚**
   ```dart
   Connectivity().onConnectivityChanged.listen((result) {
     if (result != ConnectivityResult.none) {
       ref.read(offlineQueueProvider.notifier).processQueue();
     }
   });
   ```

3. **æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå†é€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ãŸæ™‚

#### IDç½®æ›ã®ä»•çµ„ã¿

**æ³¨æ„**: å®Œå…¨ãªå®Ÿè£…ã¯ã€Œ9.4.3 _executeOperation ã®å®Ÿè£…ã€ã® `_replaceTempIdWithRealId` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã¯æ¦‚è¦ã§ã™ã€‚

1. **ä¸€æ™‚IDç”Ÿæˆ**:
   - `generateTempId()` é–¢æ•°ã‚’ä½¿ç”¨ï¼ˆå®Ÿè£…ã¯ã€Œ9.4.4 _saveToOfflineQueue ã®å®Ÿè£…ã€ã‚’å‚ç…§ï¼‰

2. **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼å‡¦ç†ã§ã®è‡ªå‹•ç½®æ›**:
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚ã« `processQueue()` ãŒè‡ªå‹•å®Ÿè¡Œ
   - CREATE æ“ä½œæˆåŠŸæ™‚ã« `_replaceTempIdWithRealId()` ãŒå‘¼ã°ã‚Œã‚‹
   - ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã•ã‚ŒãŸæœ¬ç‰©ã® `Word` ã§ç½®ãæ›ãˆ
   - **é‡è¦**: çŠ¶æ…‹æ›´æ–°ã ã‘ã§ãªãã€SharedPreferencesã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚‚æ›´æ–°ã•ã‚Œã‚‹

3. **ç½®æ›å‡¦ç†ã®æµã‚Œ**:
   ```dart
   // 1. ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰æœ¬ç‰©ã®Wordã‚’å–å¾—
   final realWord = await repository.createWord(...);

   // 2. tempId â†’ æœ¬IDã«ç½®æ›ï¼ˆçŠ¶æ…‹ + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
   await _replaceTempIdWithRealId(
     tempId: operation.tempId!,
     realWord: realWord,  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã•ã‚ŒãŸå®Œå…¨ãªWord
   );
   // ã“ã®é–¢æ•°å†…ã§ stateæ›´æ–° ã¨ _saveToCache ãŒå®Ÿè¡Œã•ã‚Œã‚‹
   ```

#### ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥

**æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã‚’ä½¿ç”¨**:

```dart
Future<void> processQueue() async {
  final queue = await loadQueue();
  final pendingOperations = [...queue];

  for (final operation in pendingOperations) {
    // æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ãƒã‚§ãƒƒã‚¯
    if (operation.retryCount >= 3) {
      AppLogger.warning('Max retry count reached for operation ${operation.id}');
      // ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤ï¼ˆå¤±æ•—ã¨ã—ã¦è¨˜éŒ²ï¼‰
      await removeFromQueue(operation.id);
      continue;
    }

    // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã®è¨ˆç®—
    final backoffDelay = Duration(seconds: pow(2, operation.retryCount).toInt());
    if (operation.lastAttemptAt != null &&
        DateTime.now().difference(operation.lastAttemptAt!) < backoffDelay) {
      // ã¾ã å¾…æ©Ÿæ™‚é–“ä¸­
      continue;
    }

    try {
      await _executeOperation(operation);
      // æˆåŠŸ: ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
      await removeFromQueue(operation.id);
    } catch (e) {
      // å¤±æ•—: ãƒªãƒˆãƒ©ã‚¤å›æ•°ã‚’å¢—ã‚„ã—ã¦ä¿å­˜
      final updatedOperation = operation.copyWith(
        retryCount: operation.retryCount + 1,
        lastAttemptAt: DateTime.now(),
      );
      await updateQueue(operation.id, updatedOperation);
    }
  }
}
```

**ãƒªãƒˆãƒ©ã‚¤é–“éš”**:
- 1å›ç›®: å³åº§ã«å®Ÿè¡Œ
- 2å›ç›®: 2ç§’å¾Œ
- 3å›ç›®: 4ç§’å¾Œ
- 4å›ç›®ä»¥é™: å¤±æ•—ã¨ã—ã¦å‰Šé™¤

#### _executeOperation ã®å®Ÿè£…

å„æ“ä½œã‚¿ã‚¤ãƒ—ï¼ˆCREATE/UPDATE/DELETEï¼‰ã«å¿œã˜ãŸå‡¦ç†ã‚’å®Ÿè¡Œ:

```dart
Future<void> _executeOperation(PendingOperation operation) async {
  switch (operation.operationType) {
    case 'CREATE':
      await _executeCreateOperation(operation);
      break;
    case 'UPDATE':
      await _executeUpdateOperation(operation);
      break;
    case 'DELETE':
      await _executeDeleteOperation(operation);
      break;
    default:
      throw Exception('Unknown operation type: ${operation.operationType}');
  }
}

/// CREATEæ“ä½œã®å®Ÿè¡Œ
Future<void> _executeCreateOperation(PendingOperation operation) async {
  final repository = ref.read(wordbookRepositoryProvider);

  // ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
  final response = await repository.createWord(
    word: operation.data['word'] as String,
    meaning: operation.data['meaning'] as String,
    example: operation.data['example'] as String?,
    category: WordCategory.values.firstWhere(
      (e) => e.name == operation.data['category'],
    ),
    status: WordStatus.values.firstWhere(
      (e) => e.name == operation.data['status'],
    ),
    tags: (operation.data['tags'] as List<dynamic>?)?.cast<String>() ?? [],
  );

  // tempId â†’ æœ¬IDã«ç½®æ›
  await _replaceTempIdWithRealId(
    tempId: operation.tempId!,
    realWord: response,
  );
}

/// UPDATEæ“ä½œã®å®Ÿè¡Œ
Future<void> _executeUpdateOperation(PendingOperation operation) async {
  final repository = ref.read(wordbookRepositoryProvider);

  final response = await repository.updateWord(
    id: operation.wordId!,
    word: operation.data['word'] as String?,
    meaning: operation.data['meaning'] as String?,
    example: operation.data['example'] as String?,
    category: operation.data['category'] != null
        ? WordCategory.values.firstWhere(
            (e) => e.name == operation.data['category'],
          )
        : null,
    status: operation.data['status'] != null
        ? WordStatus.values.firstWhere(
            (e) => e.name == operation.data['status'],
          )
        : null,
    tags: operation.data['tags'] as List<String>?,
  );

  // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
  final currentWords = state.value ?? [];
  final index = currentWords.indexWhere((w) => w.id == operation.wordId);

  if (index != -1) {
    final newWords = [...currentWords];
    newWords[index] = response;
    state = AsyncData(newWords);
    await _saveToCache(newWords);
  }
}

/// DELETEæ“ä½œã®å®Ÿè¡Œï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³9.6ã§æ—¢ã«å®šç¾©æ¸ˆã¿ï¼‰
Future<void> _executeDeleteOperation(PendingOperation operation) async {
  try {
    final repository = ref.read(wordbookRepositoryProvider);
    await repository.deleteWord(operation.wordId!);

    // æˆåŠŸ: ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰å‰Šé™¤ï¼ˆæ—¢ã«å‰Šé™¤æ¸ˆã¿ã®ã¯ãšï¼‰
    // å¿µã®ãŸã‚ç¢ºèªã—ã¦å‰Šé™¤
    final currentWords = state.value ?? [];
    if (currentWords.any((w) => w.id == operation.wordId)) {
      final newWords = currentWords.where((w) => w.id != operation.wordId).toList();
      state = AsyncData(newWords);
      await _saveToCache(newWords);
    }
  } on DioException catch (e) {
    if (e.response?.statusCode == 404) {
      // æ—¢ã«ã‚µãƒ¼ãƒãƒ¼ã§å‰Šé™¤æ¸ˆã¿ï¼ˆåˆ¥ãƒ‡ãƒã‚¤ã‚¹ã§å‰Šé™¤ã•ã‚ŒãŸå¯èƒ½æ€§ï¼‰
      // æ­£å¸¸ã¨ã—ã¦æ‰±ã†ï¼ˆä¾‹å¤–ã‚’æŠ•ã’ãªã„ï¼‰
      AppLogger.info('Word already deleted on server');
      return;
    }
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤ã®ãŸã‚ä¾‹å¤–ã‚’æŠ•ã’ã‚‹
    rethrow;
  }
}

/// tempId â†’ æœ¬IDã«ç½®æ›ï¼ˆæŒ‡æ‘˜3ã¨çµ±åˆï¼‰
Future<void> _replaceTempIdWithRealId({
  required String tempId,
  required Word realWord,
}) async {
  final currentWords = state.value ?? [];
  final updatedWords = currentWords.map((word) {
    if (word.id == tempId) {
      return realWord;  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã•ã‚ŒãŸæœ¬ç‰©ã®Wordã§ç½®ãæ›ãˆ
    }
    return word;
  }).toList();

  // çŠ¶æ…‹ã‚’æ›´æ–°
  state = AsyncData(updatedWords);

  // SharedPreferencesã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
  await _saveToCache(updatedWords);

  AppLogger.info('Replaced tempId $tempId with real ID ${realWord.id}');
}
```

#### é‡è¤‡é˜²æ­¢

åŒã˜æ“ä½œãŒè¤‡æ•°å›ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹:

```dart
Future<void> addToQueue(PendingOperation operation) async {
  final queue = await loadQueue();

  // é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆä¸€æ™‚IDã¾ãŸã¯å˜èªIDã§ï¼‰
  final isDuplicate = queue.any((op) {
    if (operation.operationType == 'CREATE') {
      return op.tempId == operation.tempId;
    } else {
      return op.wordId == operation.wordId &&
             op.operationType == operation.operationType;
    }
  });

  if (!isDuplicate) {
    queue.add(operation);
    await saveQueue(queue);
  }
}
```

#### ã‚¢ãƒ—ãƒªå†èµ·å‹•æ™‚ã®å‡¦ç†

**æ°¸ç¶šåŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªå†èµ·å‹•å¾Œã‚‚ä¿æŒ**:
1. SharedPreferences ã‹ã‚‰ã‚­ãƒ¥ãƒ¼ã‚’èª­ã¿è¾¼ã¿
2. `initState()` ã§ `processQueue()` ã‚’å®Ÿè¡Œ
3. æœªé€ä¿¡ã®æ“ä½œã‚’è‡ªå‹•çš„ã«å†é€

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**é€ä¿¡å¤±æ•—æ™‚ã®è¡¨ç¤º**:
```dart
// UIã§ã‚­ãƒ¥ãƒ¼ã®çŠ¶æ…‹ã‚’è¡¨ç¤º
Consumer(
  builder: (context, ref, child) {
    final queueCount = ref.watch(offlineQueueProvider).length;

    if (queueCount > 0) {
      return Banner(
        message: '$queueCountä»¶ã®æœªé€ä¿¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™',
        onTap: () {
          ref.read(offlineQueueProvider.notifier).processQueue();
        },
      );
    }
    return const SizedBox.shrink();
  },
)
```

#### _saveToOfflineQueue ã®å®Ÿè£…

ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«å˜èªã‚’è¿½åŠ ã™ã‚‹éš›ã®å®Œå…¨ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚

**ç›®çš„**:
- ä¸€æ™‚IDã‚’ç”Ÿæˆã—ã€å³åº§ã«UIã«åæ˜ 
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ“ä½œã‚’ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›

**å®Ÿè£…**:

```dart
/// ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã«å˜èªã‚’è¿½åŠ ã™ã‚‹
Future<void> _saveToOfflineQueue({
  required String word,
  required String meaning,
  String? example,
  required WordCategory category,
  required WordStatus status,
  List<String> tags = const [],
}) async {
  // ã‚¨ãƒ©ãƒ¼æ™‚ã«çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹ãŸã‚ã€å…ƒã®çŠ¶æ…‹ã‚’ä¿å­˜
  final originalWords = state.value ?? [];

  try {
    // 1. ä¸€æ™‚IDã‚’ç”Ÿæˆ
    final tempId = generateTempId();

    // 2. èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‹ã‚‰å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
    final authState = ref.read(authProvider);
    final userId = authState.whenOrNull(
      authenticated: (user) => user.id,
    );

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ããªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
    if (userId == null) {
      throw Exception('User not authenticated');
    }

    // 3. ä¸€æ™‚çš„ãªWordã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
    final tempWord = Word(
      id: tempId,
      userId: userId,  // å®Ÿéš›ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
      word: word,
      meaning: meaning,
      example: example,
      category: category,
      status: status,
      tags: tags,
      createdAt: DateTime.now(),
      updatedAt: DateTime.now(),
    );

    // 4. å³åº§ã«stateã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æŒ¿å…¥ï¼ˆæ¥½è¦³çš„UIæ›´æ–°ï¼‰
    final newWords = [tempWord, ...originalWords];
    state = AsyncData(newWords);
    await _saveToCache(newWords);

    // 5. PendingOperationã‚’ä½œæˆã—ã¦ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜
    final operation = PendingOperation(
      id: const Uuid().v4(),  // æ“ä½œã®ä¸€æ„ID
      operationType: 'CREATE',
      tempId: tempId,  // CREATEã®å ´åˆã¯å¿…é ˆ
      wordId: null,    // CREATEã®å ´åˆã¯null
      data: {
        // å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ ¼ç´
        'word': word,
        'meaning': meaning,
        if (example != null) 'example': example,
        'category': category.name,
        'status': status.name,
        'tags': tags,
      },
      createdAt: DateTime.now(),
      retryCount: 0,
      lastAttemptAt: null,
    );

    // 6. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
    await ref.read(offlineQueueProvider.notifier).addOperation(operation);

    // 7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤ºï¼‰
    _showSnackBar('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ä¿å­˜ã—ã¾ã—ãŸã€‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã«è‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã™ã€‚');

    AppLogger.info(
      'Saved word to offline queue',
      tag: 'WordbookNotifier',
      data: {'tempId': tempId, 'word': word},
    );
  } catch (e, stackTrace) {
    AppLogger.error(
      'Failed to save to offline queue',
      tag: 'WordbookNotifier',
      error: e,
      stackTrace: stackTrace,
    );

    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯å…ƒã®çŠ¶æ…‹ã«æˆ»ã™ï¼ˆæ—¢å­˜ã®å˜èªãƒªã‚¹ãƒˆã‚’ä¿æŒï¼‰
    state = AsyncData(originalWords);
    await _saveToCache(originalWords);

    _showSnackBar('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  }
}

/// ä¸€æ™‚IDã‚’ç”Ÿæˆ
String generateTempId() => 'temp_${const Uuid().v4()}';

/// ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã‚’è¡¨ç¤ºï¼ˆå®Ÿè£…ä¾‹ï¼‰
void _showSnackBar(String message) {
  // ScaffoldMessengerã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã‚’è¡¨ç¤º
  // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€ref.read(scaffoldMessengerProvider)ãªã©ã‚’ä½¿ç”¨
  // ã¾ãŸã¯ã€çŠ¶æ…‹ç®¡ç†çµŒç”±ã§UIã«é€šçŸ¥ã‚’é€ã‚‹
  AppLogger.info('SnackBar: $message', tag: 'WordbookNotifier');
}
```

**ä½¿ç”¨ä¾‹**:

`_saveToOfflineQueue` ã¯ `WordbookNotifier.addWord` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚å®Œå…¨ãªå®Ÿè£…ã¯ **ã‚»ã‚¯ã‚·ãƒ§ãƒ³7.1.3 WordbookNotifier** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³**:

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå˜èªã‚’è¿½åŠ ]
        â†“
[ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯]
        â†“
    [ã‚ªãƒ•ãƒ©ã‚¤ãƒ³]
        â†“
[1. generateTempId() ã§ä¸€æ™‚IDç”Ÿæˆ]
        â†“
[2. authProviderã‹ã‚‰å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼IDå–å¾—]
   â†’ æœªèªè¨¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼
        â†“
[3. tempIdã¨userIdã‚’ä½¿ã£ã¦Wordã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ]
        â†“
[4. stateæ›´æ–° + _saveToCache()]
   â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯å³åº§ã«è¡¨ç¤ºã•ã‚Œã‚‹
        â†“
[5. PendingOperationä½œæˆ]
   â†’ data ã«å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ ¼ç´
        â†“
[6. offlineQueueProviderã«è¿½åŠ ]
   â†’ SharedPreferences ã«æ°¸ç¶šåŒ–
        â†“
[7. ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼è¡¨ç¤º]
   ã€Œã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ä¿å­˜ã—ã¾ã—ãŸã€
        â†“
[å®Œäº†: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å˜èªã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹]
        â†“
[ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚]
        â†“
[processQueue() ãŒè‡ªå‹•å®Ÿè¡Œ]
        â†“
[_executeCreateOperation()]
        â†“
[ã‚µãƒ¼ãƒãƒ¼ã«POST â†’ æœ¬ç‰©ã®IDã‚’å–å¾—]
        â†“
[_replaceTempIdWithRealId()]
   â†’ tempId â†’ æœ¬ID ã«ç½®æ›
   â†’ state + cache æ›´æ–°
        â†“
[ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤]
        â†“
[å®Œäº†: å˜èªãŒã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸ]
```

**é‡è¦ãªæ³¨æ„ç‚¹**:

1. **æ¥½è¦³çš„UIæ›´æ–°**: `_saveToOfflineQueue` ã¯å³åº§ã« state ã¨ cache ã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¿½åŠ ã—ãŸå˜èªã‚’ã™ãã«è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

2. **å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ä½¿ç”¨**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã‚‚ `authProvider` ã‹ã‚‰å®Ÿéš›ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚æœªèªè¨¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

3. **å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¿å­˜**: `PendingOperation.data` ã«ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆword, meaning, example, category, status, tagsï¼‰ã‚’æ ¼ç´ã—ã¾ã™ã€‚

4. **tempIdã®é‡è¦æ€§**: CREATEæ“ä½œã§ã¯ tempId ãŒå¿…é ˆã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚ã«æ­£ã—ã„å˜èªã‚’æœ¬ç‰©ã®IDã§ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¿å­˜ã«å¤±æ•—ã—ãŸå ´åˆã¯å…ƒã®çŠ¶æ…‹ï¼ˆã‚¨ãƒ©ãƒ¼ç™ºç”Ÿå‰ã®å˜èªãƒªã‚¹ãƒˆï¼‰ã«å¾©å…ƒã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¹ãƒŠãƒƒã‚¯ãƒãƒ¼ã§ã‚¨ãƒ©ãƒ¼ã‚’é€šçŸ¥ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ—¢å­˜ã®å˜èªãƒªã‚¹ãƒˆãŒç ´å£Šã•ã‚Œã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

6. **è‡ªå‹•åŒæœŸ**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚ã« `processQueue()` ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ‰‹å‹•ã§åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### 9.5 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªç·¨é›†ãƒ•ãƒ­ãƒ¼

```
[ç·¨é›†ç”»é¢]
    â†“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰æ›´
    â†“ ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    â†“ æˆåŠŸ
    â†“
WordbookNotifier.updateWord()
    â†“
1. PUT /api/wordbook/{id}ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ï¼‰
    â†“ DioException: No internet connection
    â†“
2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã« UPDATE æ“ä½œã‚’è¿½åŠ 
    â†“ OfflineQueue.add(PendingOperation{
    â†“   operationType: 'UPDATE',
    â†“   wordId: word.id,
    â†“   data: { å¤‰æ›´å†…å®¹ }
    â†“ })
    â†“
3. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’å³åº§ã«æ›´æ–°
    â†“ stateå†…ã®è©²å½“å˜èªã‚’æ›´æ–°å€¤ã§ç½®ãæ›ãˆ
    â†“
4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    â†“ SharedPreferences
    â†“
[ä¸€è¦§ç”»é¢ã¾ãŸã¯è©³ç´°ç”»é¢ã¸æˆ»ã‚‹]
    â†“
[å¤‰æ›´ãŒå³åº§ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹]
    â†“
[ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°]
    â†“
OfflineQueue.processQueue()
    â†“
PUT /api/wordbook/{id}ï¼ˆãƒªãƒˆãƒ©ã‚¤ï¼‰
    â†“
æˆåŠŸ: ã‚µãƒ¼ãƒãƒ¼ã®æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã§ä¸Šæ›¸ã
å¤±æ•—: ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã«æ®‹ã‚‹
```

#### ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã®å³åº§åæ˜ 

ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¤‰æ›´ã¯å³åº§ã«UIã«åæ˜ ã•ã‚Œã¾ã™:

```dart
Future<void> updateWord({
  required String id,
  String? word,
  String? meaning,
  String? example,
  WordCategory? category,
  WordStatus? status,
  List<String>? tags,
}) async {
  try {
    final repository = ref.read(wordbookRepositoryProvider);
    final updatedWord = await repository.updateWord(
      id: id,
      word: word,
      meaning: meaning,
      example: example,
      category: category,
      status: status,
      tags: tags,
    );

    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å€¤ã§æ›´æ–°
    _updateLocalState(updatedWord);
  } on DioException catch (e) {
    if (e.type == DioExceptionType.connectionTimeout ||
        e.type == DioExceptionType.unknown) {
      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³: ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ãŸæ›´æ–°å€¤ã‚’å³åº§ã«åæ˜ 
      final currentWords = state.value ?? [];
      final currentWord = currentWords.firstWhere((w) => w.id == id);

      final updatedWord = currentWord.copyWith(
        word: word ?? currentWord.word,
        meaning: meaning ?? currentWord.meaning,
        example: example ?? currentWord.example,
        category: category ?? currentWord.category,
        status: status ?? currentWord.status,
        tags: tags ?? currentWord.tags,
        updatedAt: DateTime.now(),  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
      );

      // ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
      _updateLocalState(updatedWord);

      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
      await _addToOfflineQueue(
        operationType: 'UPDATE',
        wordId: id,
        data: {
          if (word != null) 'word': word,
          if (meaning != null) 'meaning': meaning,
          if (example != null) 'example': example,
          if (category != null) 'category': category.name,
          if (status != null) 'status': status.name,
          if (tags != null) 'tags': tags,
        },
      );

      AppLogger.info('Saved word update to offline queue');
      showSnackBar('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®ãŸã‚ã€å¾Œã§è‡ªå‹•é€ä¿¡ã—ã¾ã™ã€‚');
    } else {
      // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
      AppLogger.error('Failed to update word', error: e);
      showSnackBar('å˜èªã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      rethrow;
    }
  }
}

void _updateLocalState(Word updatedWord) {
  final currentWords = state.value ?? [];
  final index = currentWords.indexWhere((w) => w.id == updatedWord.id);

  if (index != -1) {
    final newWords = [...currentWords];
    newWords[index] = updatedWord;
    state = AsyncData(newWords);
    _saveToCache(newWords);
  }
}
```

#### ç«¶åˆå‡¦ç†

**æ–¹é‡**: Last Write Winsï¼ˆæœ€å¾Œã®æ›¸ãè¾¼ã¿ãŒå‹ã¤ï¼‰

- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç·¨é›†å¾Œã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«ã‚µãƒ¼ãƒãƒ¼ã¸é€ä¿¡
- ã‚µãƒ¼ãƒãƒ¼ã¯æœ€å¾Œã«å—ä¿¡ã—ãŸå€¤ã§ä¸Šæ›¸ãï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹ã®ç«¶åˆè§£æ±ºã¯ä¸è¦ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ„å›³çš„ã«ç·¨é›†ã—ãŸå†…å®¹ãŒå¸¸ã«å„ªå…ˆã•ã‚Œã‚‹

**è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ã®ç«¶åˆ**:
- åŒã˜å˜èªã‚’è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§åŒæ™‚ç·¨é›†ã—ãŸå ´åˆã€æœ€å¾Œã«é€ä¿¡ã•ã‚ŒãŸæ–¹ãŒå‹ã¤
- ç¾æ™‚ç‚¹ã§ã¯è‡ªå‹•ãƒãƒ¼ã‚¸ã‚„ç«¶åˆæ¤œå‡ºã¯å®Ÿè£…ã—ãªã„ï¼ˆå°†æ¥ã®æ‹¡å¼µã¨ã—ã¦æ¤œè¨ï¼‰

### 9.6 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®å˜èªå‰Šé™¤ãƒ•ãƒ­ãƒ¼

```
[è©³ç´°ç”»é¢ã¾ãŸã¯ä¸€è¦§ç”»é¢]
    â†“ å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    â†“
å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
    â†“ ç¢ºèª
    â†“
WordbookNotifier.deleteWord()
    â†“
1. DELETE /api/wordbook/{id}ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ï¼‰
    â†“ DioException: No internet connection
    â†“
2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã« DELETE æ“ä½œã‚’è¿½åŠ 
    â†“ OfflineQueue.add(PendingOperation{
    â†“   operationType: 'DELETE',
    â†“   wordId: word.id
    â†“ })
    â†“
3. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰å³åº§ã«å‰Šé™¤
    â†“ state ã‹ã‚‰è©²å½“å˜èªã‚’é™¤å¤–
    â†“
4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
    â†“ SharedPreferences
    â†“
[ä¸€è¦§ç”»é¢ã¸æˆ»ã‚‹]
    â†“
[å˜èªãŒå³åº§ã«éè¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹]
    â†“
[ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°]
    â†“
OfflineQueue.processQueue()
    â†“
DELETE /api/wordbook/{id}ï¼ˆãƒªãƒˆãƒ©ã‚¤ï¼‰
    â†“
æˆåŠŸ: ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
å¤±æ•—ï¼ˆ404ç­‰ï¼‰: æ—¢ã«å‰Šé™¤æ¸ˆã¿ã¨ã¿ãªã—ã¦ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
å¤±æ•—ï¼ˆãã®ä»–ï¼‰: ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã«æ®‹ã‚‹
```

#### ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã®å³åº§å‰Šé™¤

ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã§ã‚‚ã€å‰Šé™¤æ“ä½œã¯å³åº§ã«UIã«åæ˜ ã•ã‚Œã¾ã™:

```dart
Future<void> deleteWord(String id) async {
  try {
    final repository = ref.read(wordbookRepositoryProvider);
    await repository.deleteWord(id);

    // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³: ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰å‰Šé™¤
    _removeFromLocalState(id);
  } on DioException catch (e) {
    if (e.type == DioExceptionType.connectionTimeout ||
        e.type == DioExceptionType.unknown) {
      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³: ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‹ã‚‰å³åº§ã«å‰Šé™¤
      _removeFromLocalState(id);

      // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
      await _addToOfflineQueue(
        operationType: 'DELETE',
        wordId: id,
        data: {},
      );

      AppLogger.info('Saved word deletion to offline queue');
      showSnackBar('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®ãŸã‚ã€å¾Œã§è‡ªå‹•å‰Šé™¤ã—ã¾ã™ã€‚');
    } else {
      // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
      AppLogger.error('Failed to delete word', error: e);
      showSnackBar('å˜èªã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      rethrow;
    }
  }
}

void _removeFromLocalState(String id) {
  final currentWords = state.value ?? [];
  final newWords = currentWords.where((w) => w.id != id).toList();
  state = AsyncData(newWords);
  _saveToCache(newWords);
}
```

#### å‰Šé™¤æ“ä½œã®ç‰¹æ®Šå‡¦ç†

**404ã‚¨ãƒ©ãƒ¼ã®æ‰±ã„**:
ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ã®å‰Šé™¤æ“ä½œé€ä¿¡æ™‚ã« 404ï¼ˆNot Foundï¼‰ãŒè¿”ã•ã‚ŒãŸå ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«å‡¦ç†:

```dart
Future<void> _executeDeleteOperation(PendingOperation operation) async {
  try {
    await _apiClient.dio.delete('/api/wordbook/${operation.wordId}');
    // æˆåŠŸ: ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤
    await removeFromQueue(operation.id);
  } on DioException catch (e) {
    if (e.response?.statusCode == 404) {
      // æ—¢ã«ã‚µãƒ¼ãƒãƒ¼ã§å‰Šé™¤æ¸ˆã¿ï¼ˆåˆ¥ãƒ‡ãƒã‚¤ã‚¹ã§å‰Šé™¤ã•ã‚ŒãŸå¯èƒ½æ€§ï¼‰
      // ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å‰Šé™¤ã—ã¦æ­£å¸¸çµ‚äº†
      await removeFromQueue(operation.id);
      AppLogger.info('Word already deleted on server');
    } else {
      // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼: ãƒªãƒˆãƒ©ã‚¤
      rethrow;
    }
  }
}
```

**å¾©å…ƒä¸å¯**:
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‰Šé™¤å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå…ƒã«æˆ»ã™ã€ã“ã¨ã¯ã§ããªã„ä»•æ§˜
- èª¤å‰Šé™¤ã‚’é˜²ããŸã‚ã€å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å¿…ãšè¡¨ç¤ºã™ã‚‹
- å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦ã€Œå‰Šé™¤å¾Œ30ç§’ä»¥å†…ãªã‚‰å…ƒã«æˆ»ã›ã‚‹ã€ãªã©ã‚’æ¤œè¨å¯èƒ½

---

## 10. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 10.1 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚’å«ã‚€å®Œå…¨ãª `addWord` å®Ÿè£…ã¯ã€**ã‚»ã‚¯ã‚·ãƒ§ãƒ³7.1.3 WordbookNotifier** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ (`Connectivity`)
2. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚: ç›´æ¥APIã«POSTã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
3. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚: `_saveToOfflineQueue` ã§ã‚­ãƒ¥ãƒ¼ã«ä¿å­˜
4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚: è‡ªå‹•çš„ã«ã‚­ãƒ¥ãƒ¼ã‚’å‡¦ç†

### 10.2 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

```dart
String? validateWord(String word) {
  if (word.isEmpty) {
    return 'å˜èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
  }
  if (word.length > 100) {
    return 'å˜èªã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
  }
  return null;
}

String? validateMeaning(String meaning) {
  if (meaning.isEmpty) {
    return 'æ„å‘³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
  }
  if (meaning.length > 200) {
    return 'æ„å‘³ã¯200æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
  }
  return null;
}

String? validateExample(String? example) {
  if (example != null && example.length > 500) {
    return 'ä¾‹æ–‡ã¯500æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
  }
  return null;
}
```

**UIã§ã®è¡¨ç¤º**:
```dart
TextField(
  decoration: InputDecoration(
    labelText: 'å˜èª',
    errorText: _wordError,  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
  ),
  onChanged: (value) {
    setState(() {
      _wordError = validateWord(value);
    });
  },
)
```

### 10.3 é‡è¤‡ãƒã‚§ãƒƒã‚¯

ã‚µãƒ¼ãƒãƒ¼å´ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯:
```typescript
// backend/src/app/api/wordbook/route.ts
export async function POST(req: Request) {
  const { word, userId } = await req.json();

  // é‡è¤‡ãƒã‚§ãƒƒã‚¯
  const existing = await prisma.wordbook.findFirst({
    where: {
      userId: userId,
      word: word,
    },
  });

  if (existing) {
    return NextResponse.json(
      { error: 'ã“ã®å˜èªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚' },
      { status: 409 }
    );
  }

  // å˜èªã‚’ä½œæˆ
  const newWord = await prisma.wordbook.create({
    data: { word, userId, /* ... */ },
  });

  return NextResponse.json(newWord, { status: 201 });
}
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:
```dart
try {
  await ref.read(wordbookNotifierProvider.notifier).addWord(/* ... */);
} on DioException catch (e) {
  if (e.response?.statusCode == 409) {
    // é‡è¤‡ã‚¨ãƒ©ãƒ¼
    showSnackBar('ã“ã®å˜èªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚');
  }
}
```

---

## 11. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 11.1 ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:
1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³åº§ã«UIã«è¡¨ç¤º
2. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
3. å·®åˆ†ãŒã‚ã‚Œã°è‡ªå‹•çš„ã«æ›´æ–°

**åˆ©ç‚¹**:
- åˆå›è¡¨ç¤ºãŒé«˜é€Ÿï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
- ã‚µãƒ¼ãƒãƒ¼è² è·è»½æ¸›

### 11.2 æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®æœ€é©åŒ–

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**:
- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆåˆå›ã®ã¿ï¼‰
- ä»¥é™ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- æ¤œç´¢ã¯å³åº§ã«åæ˜ ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã—ï¼‰

**å¤§é‡ãƒ‡ãƒ¼ã‚¿å¯¾ç­–**:
```dart
// å˜èªæ•°ãŒå¤šã„å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
@riverpod
class PaginatedWords extends _$PaginatedWords {
  static const _pageSize = 50;

  @override
  FutureOr<List<Word>> build(int page) async {
    final allWords = ref.watch(wordbookNotifierProvider).value ?? [];
    final start = page * _pageSize;
    final end = start + _pageSize;

    return allWords.sublist(
      start,
      end > allWords.length ? allWords.length : end,
    );
  }
}
```

### 11.3 UIæ›´æ–°ã®æœ€é©åŒ–

**éƒ¨åˆ†çš„ãªå†æç”»**:
```dart
// æ¤œç´¢ã‚¯ã‚¨ãƒªã®ã¿ã‚’ç›£è¦–
Consumer(
  builder: (context, ref, child) {
    final filteredWords = ref.watch(
      filteredWordsProvider(
        category: _category,
        statusFilters: _statusFilters,
        searchQuery: _searchQuery,
      ).select((words) => words),
    );

    return WordGridView(words: filteredWords);
  },
)
```

**ä¸è¦ãªå†æ§‹ç¯‰ã‚’é¿ã‘ã‚‹**:
```dart
// ã‚«ãƒ†ã‚´ãƒªãƒ¼ãŒå¤‰ã‚ã£ãŸæ™‚ã®ã¿å†æ§‹ç¯‰
Consumer(
  builder: (context, ref, child) {
    final category = ref.watch(selectedCategoryProvider);
    return CategoryTab(category: category);
  },
)
```

---

## 12. ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

### 12.1 é–“éš”åå¾©å­¦ç¿’ï¼ˆSRSï¼‰

**Spaced Repetition System ã®å®Ÿè£…**:
- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ : SM-2ï¼ˆSuperMemo 2ï¼‰
- å¾©ç¿’ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è‡ªå‹•è¨ˆç®—
- æ­£è§£ç‡ã«å¿œã˜ã¦æ¬¡å›å¾©ç¿’æ—¥ã‚’èª¿æ•´

**ãƒ‡ãƒ¼ã‚¿è¿½åŠ **:
```prisma
model Wordbook {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  easeFactor      Float        @default(2.5)  // SM-2 ease factor
  interval        Int          @default(0)    // æ¬¡å›å¾©ç¿’ã¾ã§ã®æ—¥æ•°
  repetitions     Int          @default(0)    // é€£ç¶šæ­£è§£å›æ•°
  nextReviewAt    DateTime?                   // æ¬¡å›å¾©ç¿’æ—¥
}
```

**å¾©ç¿’ç”»é¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä»Šæ—¥ã®å¾©ç¿’: 5å˜èª               â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ì„¤ë ˆë‹¤                 â”‚     â”‚
â”‚  â”‚  æ„å‘³ã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„â”‚     â”‚
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚  [è¡¨ç¤º]                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â”‚
â”‚  â†“ ã‚¿ãƒƒãƒ—ã§æ„å‘³ã‚’è¡¨ç¤º            â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ã¨ãã‚ã                â”‚     â”‚
â”‚  â”‚                        â”‚     â”‚
â”‚  â”‚  è¦šãˆã¦ã„ã¾ã—ãŸã‹ï¼Ÿ      â”‚     â”‚
â”‚  â”‚  [å¿˜ã‚ŒãŸ] [æ€ã„å‡ºã—ãŸ]  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 å˜èªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

**4æŠã‚¯ã‚¤ã‚º**:
- ãƒ©ãƒ³ãƒ€ãƒ ã«å˜èªã‚’å‡ºé¡Œ
- 4ã¤ã®é¸æŠè‚¢ã‹ã‚‰æ­£è§£ã‚’é¸ã¶
- æ­£è§£ç‡ã‚’è¨˜éŒ²ã—ã¦çµ±è¨ˆã«åæ˜ 

**ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ã¨ã®é€£æº**:
- å˜èªå¸³ã®å˜èªã‚’ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’ã«è¿½åŠ 
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒƒã‚¹ãƒ³ã®è‡ªå‹•ç”Ÿæˆ
- å¼±ç‚¹å˜èªã‚’é›†ä¸­çš„ã«ç·´ç¿’

---

## ä»˜éŒ²: å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: ãƒ‡ãƒ¼ã‚¿å±¤ã®å®Ÿè£…
- [ ] Prismaã‚¹ã‚­ãƒ¼ãƒã®è¿½åŠ ï¼ˆ`Wordbook`ãƒ¢ãƒ‡ãƒ«ï¼‰
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆãƒ»å®Ÿè¡Œ
- [ ] Freezedãƒ¢ãƒ‡ãƒ«ã®ä½œæˆï¼ˆ`Word`ã‚¯ãƒ©ã‚¹ï¼‰
- [ ] WordbookRepositoryã®å®Ÿè£…
- [ ] WordbookNotifierProviderã®å®Ÿè£…

### Phase 2: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…
- [ ] `GET /api/wordbook` - å˜èªä¸€è¦§å–å¾—
- [ ] `POST /api/wordbook` - å˜èªè¿½åŠ 
- [ ] `PUT /api/wordbook/{id}` - å˜èªæ›´æ–°
- [ ] `DELETE /api/wordbook/{id}` - å˜èªå‰Šé™¤
- [ ] `GET /api/wordbook/stats` - çµ±è¨ˆæƒ…å ±å–å¾—
- [ ] APIã®ãƒ†ã‚¹ãƒˆä½œæˆ

### Phase 3: UIå®Ÿè£…
- [ ] å˜èªè¿½åŠ ç”»é¢ã®å®Ÿè£…
- [ ] å˜èªç·¨é›†ç”»é¢ã®å®Ÿè£…
- [ ] å˜èªè©³ç´°ç”»é¢ã®å®Ÿè£…
  - [ ] ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨UIè¦ç´ 
  - [ ] ç·¨é›†ãƒœã‚¿ãƒ³ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ã®å®Ÿè£…
  - [ ] éŸ³å£°å†ç”Ÿãƒœã‚¿ãƒ³ã®å®Ÿè£…
  - [ ] ãƒ¡ã‚¿æƒ…å ±ï¼ˆä½œæˆæ—¥ãƒ»æ›´æ–°æ—¥ãƒ»å¾©ç¿’å›æ•°ãƒ»æ­£è§£ç‡ï¼‰ã®è¡¨ç¤º
- [ ] å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å®Ÿè£…
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
- [ ] éŸ³å£°è¨­å®šç”»é¢ã®å®Ÿè£…
  - [ ] å†ç”Ÿé€Ÿåº¦ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³
  - [ ] è‡ªå‹•å†ç”Ÿã®ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ
  - [ ] éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®é¸æŠ

### Phase 4: æ©Ÿèƒ½å®Ÿè£…
- [ ] éŸ³å£°å†ç”Ÿæ©Ÿèƒ½ï¼ˆflutter_ttsï¼‰
  - [ ] WordAudioServiceã®å®Ÿè£…
  - [ ] éŸ³å£°è¨­å®šï¼ˆAudioSettingsï¼‰ã®å®Ÿè£…
  - [ ] éŸ³å£°è¨­å®šã®æ°¸ç¶šåŒ–ï¼ˆSharedPreferencesï¼‰
  - [ ] è‡ªå‹•å†ç”Ÿæ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚­ãƒ¥ãƒ¼ï¼ˆåŒæœŸæ©Ÿèƒ½ï¼‰
  - [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¿½åŠ ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
  - [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç·¨é›†ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
  - [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‰Šé™¤ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
  - [ ] æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã«ã‚ˆã‚‹ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
  - [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ¤œçŸ¥ã¨è‡ªå‹•é€ä¿¡
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å®Ÿè£…

### Phase 5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- [ ] é‡è¤‡ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®è¡¨ç¤º

### Phase 6: æœ€é©åŒ–ãƒ»ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æœ€é©åŒ–
- [ ] UIæ›´æ–°ã®æœ€é©åŒ–
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä½œæˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã®ä½œæˆ

### Phase 7: æ‹¡å¼µæ©Ÿèƒ½ï¼ˆä»Šå¾Œï¼‰
- [ ] é–“éš”åå¾©å­¦ç¿’ï¼ˆSRSï¼‰ã®å®Ÿè£…
- [ ] å˜èªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] éŸ³å£°èªè­˜æ©Ÿèƒ½
- [ ] çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

---

ä»¥ä¸Šã§ã€å˜èªå¸³æ©Ÿèƒ½ã®è©³ç´°ä»•æ§˜æ›¸ã¯å®Œäº†ã§ã™ã€‚
